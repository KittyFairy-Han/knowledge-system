(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{303:function(t,s,a){t.exports=a.p+"assets/img/event-loop.d7bbaac2.png"},463:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"事件轮询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件轮询"}},[t._v("#")]),t._v(" 事件轮询")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/JS/single-thread-async-event-loop/'https://www.cnblogs.com/dong-xu/p/7000163.html"}},[t._v("事件轮询【参考资料】")])],1),t._v(" "),s("h2",{attrs:{id:"为什么要有宏任务、微任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要有宏任务、微任务"}},[t._v("#")]),t._v(" 为什么要有宏任务、微任务")]),t._v(" "),s("p",[t._v("更好的控制事件优先级和执行顺序，提高性能和响应性")]),t._v(" "),s("h3",{attrs:{id:"深刻理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#深刻理解"}},[t._v("#")]),t._v(" 深刻理解")]),t._v(" "),s("p",[t._v("需要时间等待的微任务就直接作为宏任务就好了呀，不需要等待的直接执行就好了呀。还是觉得微任务没啥用？"),s("br"),t._v("\n当我们遇到一个需要等待的操作（如网络请求、定时器等）时，我们通常会使用异步编程模型，将这个操作放在一个回调函数中，然后将这个回调函数放入事件队列中，等待操作完成后再执行。这样，主线程就可以继续执行其他的任务，不会被阻塞。")]),t._v(" "),s("p",[t._v("然而，这种模型有一个问题，那就是回调函数的执行时间是不确定的，它取决于事件队列中的其他任务。为了解决这个问题，JavaScript 引入了微任务。")]),t._v(" "),s("p",[t._v("微任务允许我们在当前任务结束后、下一个任务开始前，插入一些额外的任务。这意味着，我们可以确保微任务在当前任务结束后立即执行，而不需要等待事件队列中的其他任务。")]),t._v(" "),s("p",[t._v("例如，Promise 就是利用微任务来实现的。当我们调用 Promise.resolve().then(callback) 时，callback 会被放入微任务队列，等待当前任务结束后立即执行。这使得我们可以更好地控制代码的执行顺序，提高性能和响应性。")]),t._v(" "),s("h2",{attrs:{id:"宏任务-微任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#宏任务-微任务"}},[t._v("#")]),t._v(" 宏任务 微任务")]),t._v(" "),s("ul",[s("li",[t._v("宏任务：setTimeout、setInterval、immediate、I/O （后两个是 node 的）")]),t._v(" "),s("li",[t._v("微任务：Promise.then、MutationObserver、IntersectionObserver\n"),s("blockquote",[s("p",[t._v("MutationObserver 是用来监视 DOM 变化的 API。当你创建一个 MutationObserver 并使用它来监视某个 DOM 节点时，每当这个节点或其子节点发生变化时，你指定的回调函数就会被调用。这个回调函数是一个微任务，它会在当前宏任务结束后，下一个宏任务开始前执行。"),s("br"),t._v("\nIntersectionObserver 是用来监视元素与其祖先元素或视口（viewport）相交状态的 API。当你创建一个 IntersectionObserver 并使用它来监视某个元素时，每当这个元素的相交状态发生变化时，你指定的回调函数就会被调用。这个回调函数也是一个微任务，它会在当前宏任务结束后，下一个宏任务开始前执行。"),s("br"),t._v("\nPromise 中有请求，成功的时候 resolve，那么它是一个宏任务。浏览器原生的 Promise.then 是微任务")])])])]),t._v(" "),s("h2",{attrs:{id:"轮巡过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#轮巡过程"}},[t._v("#")]),t._v(" 轮巡过程")]),t._v(" "),s("p",[s("img",{attrs:{src:a(303),alt:"事件轮询"}})]),t._v(" "),s("h2",{attrs:{id:"考点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#考点"}},[t._v("#")]),t._v(" 考点")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3、end、2、4")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果去掉 resolve（2） 这行则打印 3、end、4、1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" p1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    p1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);