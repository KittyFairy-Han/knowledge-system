(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{484:function(t,a,s){"use strict";s.r(a);var r=s(14),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"渲染性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染性能"}},[t._v("#")]),t._v(" 渲染性能")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("【阮一峰-网页性能管理详解】"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"一、渲染流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、渲染流程"}},[t._v("#")]),t._v(" 一、渲染流程")]),t._v(" "),a("ol",[a("li",[t._v("Parsing：HTML 代码转化成 DOM、CSS 代码转化成 CSSOM（CSS Object Model）")]),t._v(" "),a("li",[t._v("Construction：结合 DOM 和 CSSOM，生成一棵渲染树（包含每个节点的视觉信息）")]),t._v(" "),a("li",[t._v("Layout：生成布局（layout），即将所有渲染树的所有节点进行平面合成")]),t._v(" "),a("li",[t._v("Paint：将布局绘制（paint）在屏幕上")])]),t._v(" "),a("p",[t._v('对应到性能面板，"Scripting" 阶段主要涉及到 JavaScript 的执行，包括 DOM 和 CSSOM 的构建。"Rendering" 阶段主要涉及到渲染树的构建和布局的计算。"Painting" 阶段则涉及到像素的绘制，这部分工作最后会交给 GPU 完成。')]),t._v(" "),a("ol",[a("li",[t._v("CPU-Scripting ->")]),t._v(" "),a("li",[t._v("CPU-Rendering 紫色->")]),t._v(" "),a("li",[t._v("CPU-Rendering 紫色->")]),t._v(" "),a("li",[t._v("CPU-Painting 绿色 -> Gpu")])]),t._v(" "),a("p",[t._v("当用户操作改变布局时，从第 2 步继续开始。也就是回流 reflow。"),a("br"),t._v("\n当用户操作改变外观但是不改变布局时，从第 4 步开始。也就是重绘 repaint。")]),t._v(" "),a("h2",{attrs:{id:"二、reflow-和-repaint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、reflow-和-repaint"}},[t._v("#")]),t._v(" 二、reflow 和 repaint")]),t._v(" "),a("p",[t._v("以下三种情况，会导致网页重新渲染。")]),t._v(" "),a("ul",[a("li",[t._v("修改 DOM")]),t._v(" "),a("li",[t._v("修改样式表")]),t._v(" "),a("li",[t._v("用户事件（比如鼠标悬停、页面滚动、输入框键入文字、改变窗口大小等等）")])]),t._v(" "),a("p",[t._v('重新渲染，就需要重新生成布局和重新绘制。前者叫做"重排"（reflow），后者叫做"重绘"（repaint）。')]),t._v(" "),a("h2",{attrs:{id:"三、对于性能的影响"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、对于性能的影响"}},[t._v("#")]),t._v(" 三、对于性能的影响")]),t._v(" "),a("p",[t._v("一般来说，样式的写操作之后，如果有下面这些属性的读操作，都会引发浏览器立即重新渲染。")]),t._v(" "),a("ul",[a("li",[t._v("offsetTop/offsetLeft/offsetWidth/offsetHeight")]),t._v(" "),a("li",[t._v("scrollTop/scrollLeft/scrollWidth/scrollHeight")]),t._v(" "),a("li",[t._v("clientTop/clientLeft/clientWidth/clientHeight")]),t._v(" "),a("li",[t._v("getComputedStyle()")])]),t._v(" "),a("p",[t._v("所以，从性能角度考虑，尽量不要把读操作和写操作，放在一个语句里面。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bad")]),t._v("\ndiv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetLeft "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndiv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetTop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// good")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" left "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetLeft"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" top "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" div"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetTop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndiv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" left "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndiv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" top "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("一般的规则是：")]),t._v(" "),a("ul",[a("li",[t._v("样式表越简单，重排和重绘就越快。")]),t._v(" "),a("li",[t._v("重排和重绘的 DOM 元素层级越高，成本就越高。")]),t._v(" "),a("li",[t._v("table 元素的重排和重绘成本，要高于 div 元素")])]),t._v(" "),a("h2",{attrs:{id:"四、提高性能的九个技巧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、提高性能的九个技巧"}},[t._v("#")]),t._v(" 四、提高性能的九个技巧")]),t._v(" "),a("p",[t._v("vdom、离线 dom、display=none、用 class 而不是一条一条改变、position=absolute||fixed 对 reflow 耗能小、visibility 只 repaint、js 动画使用 window.requestAnimation")]),t._v(" "),a("h2",{attrs:{id:"考点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#考点"}},[t._v("#")]),t._v(" 考点")]),t._v(" "),a("h3",{attrs:{id:"什么是回流和重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是回流和重绘"}},[t._v("#")]),t._v(" 什么是回流和重绘")]),t._v(" "),a("ul",[a("li",[t._v("回流：布局改变")]),t._v(" "),a("li",[t._v("重绘：布局不改变")])]),t._v(" "),a("h3",{attrs:{id:"什么情况触发回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么情况触发回流"}},[t._v("#")]),t._v(" 什么情况触发回流")]),t._v(" "),a("ul",[a("li",[t._v("增删 dom")]),t._v(" "),a("li",[t._v("已有 dom 尺寸和位置变化")]),t._v(" "),a("li",[t._v("激活伪类")]),t._v(" "),a("li",[t._v("窗口改变")])]),t._v(" "),a("h3",{attrs:{id:"回流的影响范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回流的影响范围"}},[t._v("#")]),t._v(" 回流的影响范围")]),t._v(" "),a("p",[t._v("自身肯定回流，对其他元素有无影响取决于是否让其他元素尺寸大小发生改变")]),t._v(" "),a("h3",{attrs:{id:"为什么-transform-不回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么-transform-不回流"}},[t._v("#")]),t._v(" 为什么 Transform 不回流")]),t._v(" "),a("ul",[a("li",[t._v("即使位置大小改变，但实际的布局不改变（不会影响到元素的盒模型尺寸和位置），不回流")]),t._v(" "),a("li",[t._v("会创建复合层，gpu 为 cpu 分担计算压力，减少 cpu 的重绘工作量。")])]),t._v(" "),a("h3",{attrs:{id:"还有哪些属性可以创建复合层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#还有哪些属性可以创建复合层"}},[t._v("#")]),t._v(" 还有哪些属性可以创建复合层")]),t._v(" "),a("p",[t._v("opacity、filter、perspective、backface-visibility、will-change")]),t._v(" "),a("h3",{attrs:{id:"复合层有缺点吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复合层有缺点吗"}},[t._v("#")]),t._v(" 复合层有缺点吗？")]),t._v(" "),a("p",[t._v("滥用会过渡消耗内存空间")]),t._v(" "),a("h3",{attrs:{id:"如何理解-cpu、gpu-在回流和重绘中的职责"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何理解-cpu、gpu-在回流和重绘中的职责"}},[t._v("#")]),t._v(" 如何理解 CPU、GPU 在回流和重绘中的职责？")]),t._v(" "),a("p",[t._v("在浏览器的渲染过程中，回流和重绘都会涉及到 CPU 和 GPU 的计算。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("回流：这个过程主要由 CPU 完成，因为它涉及到布局（元素的位置和大小）的计算。")])]),t._v(" "),a("li",[a("p",[t._v("重绘：这个过程通常涉及到 CPU 和 GPU。CPU 负责计算绘制操作（比如说确定哪些像素需要改变），然后 GPU 负责实际的绘制（填充颜色等）。")])])]),t._v(" "),a("h3",{attrs:{id:"从-cpu-和-gpu-的工作量分析-硬件加速和复合层如何达到优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从-cpu-和-gpu-的工作量分析-硬件加速和复合层如何达到优化"}},[t._v("#")]),t._v(" 从 CPU 和 GPU 的工作量分析，硬件加速和复合层如何达到优化？")]),t._v(" "),a("p",[t._v("在某些情况下，浏览器会尝试优化这个过程，比如通过创建复合层（compositing layers）或者使用硬件加速，让 GPU 分担 CPU 的压力。但是，这并不意味着重绘完全不需要 CPU，因为在 GPU 开始绘制之前，CPU 仍然需要计算出哪些部分需要重绘，原来还需要计算那些像素需要改变，现在这部分就 GPU 去计算。")])])}),[],!1,null,null,null);a.default=e.exports}}]);