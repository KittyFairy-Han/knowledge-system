<!--
 * @Author: é±¼å°æŸ”
 * @Date: 2021-01-24 11:07:56
 * @LastEditors: your name
 * @LastEditTime: 2021-09-05 23:36:20
 * @Description: webpack chunk ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œå®æˆ˜ä¾‹å­
-->

# webpack chunk

## æ‹†åˆ† chunk çš„æ„ä¹‰

å…ˆè¯´ä¸€ä¸ªæ¦‚å¿µ code splitting  
ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰â‘  å’Œé¦–å±åŠ è½½ä¼˜åŒ–æœ‰ç´§å¯†çš„å…³ç³»ï¼Œåˆ©ç”¨ code splitting çš„æ€æƒ³æŠŠä¸€äº›é¦–æ¬¡åŠ è½½ä¸ä¼šç”¨åˆ°çš„ä»£ç å•ç‹¬æ‹†åˆ†å‡ºæ¥ï¼Œé¡µé¢é¦–æ¬¡åŠ è½½æ—¶ä¸å»è¯·æ±‚è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿›è€Œæé«˜é¦–å±åŠ è½½çš„é€Ÿåº¦ã€‚â‘¡ å†æ¯”å¦‚ï¼Œå¾ˆå¤šä¸šåŠ¡ä»£ç éƒ½å¼•å…¥äº†ç›¸åŒçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶ä¸”è¿™ä¸ªä»£ç ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œè¿™ä¸ªæ—¶å€™æŠŠè¿™éƒ¨åˆ†ä»£ç å•ç‹¬æ‹†åˆ†å‡ºæ¥ï¼Œå°±å¯ä»¥å‡å°‘å…¥å£å½¢æˆçš„ chunk çš„ä½“ç§¯ã€‚å¹¶ä¸”å•ç‹¬æ‹†åˆ†å‡ºæ–‡ä»¶ä¹Ÿå¯ä»¥æé«˜ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚  
é‚£å’Œ chunk æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ  
webpack æœ€åè¾“å‡ºçš„æ–‡ä»¶æ˜¯ bundleï¼Œchunk æ˜¯ bundle çš„å‰èº«ã€‚æ‰€ä»¥æ‹†åˆ† chunk å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†æœ€å bundle æ˜¯å¦‚ä½•è¿›è¡Œ code splitting è¾“å‡ºå¤šä¸ªæ–‡ä»¶çš„

## chunk æ¥æº

1. webpack é…ç½®ä¸­çš„ entry(å…¥å£) é€‰é¡¹
2. import() æŒ‰éœ€åŠ è½½å‡½æ•°
   > import å‘½ä»¤ã€require() å‡½æ•°ä¸ä¼šäº§ç”Ÿ chunkã€‚å…·ä½“è§[import()ã€importã€require() å·¥ä½œåŸç†å’ŒåŒºåˆ«](https://kittyfairy-han.github.io/knowledge-system/engineering/design/modularity.html#å…­ã€é¢å¤–è¯´æ˜)
3. webpack é…ç½®ä¸­çš„ optimization.splitchunk é€‰é¡¹

### entry

#### å¯¹åº”å…³ç³» ğŸ–‡ï¸

æ¯ä¸€ä¸ªå…¥å£å°±ä¼šå¯¹åº”åœ°å½¢æˆä¸€ä¸ª chunkã€‚

entry å¯ä»¥é…ç½®ä¸ºå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ã€‚å‰ä¸¤ç§éƒ½æ˜¯å•å…¥å£ï¼›ç”¨å¯¹è±¡å½¢å¼é…ç½®çš„æ—¶ï¼Œæ˜¯å¤šå…¥å£ï¼Œå½¢å¦‚ entry:{e1:'å…¥å£ 1',e2:'å…¥å£ 2'}ã€‚[è¯¦ç»†å†™æ³•è¯´æ˜](https://webpack.docschina.org/concepts/entry-points/#root)ã€‚

#### ä¸¾ä¾‹è¯´æ˜ ğŸŒ°

ä¸ºäº†æ–¹ä¾¿ä»‹ç» chunk ä¸ entry çš„å¯¹åº”å…³ç³»ï¼Œä¸‹é¢ç”¨ä¸€ä¸ªå¤šé¡µåº”ç”¨ä½œä¸ºä¾‹å­ã€‚

```code
  src
  â”œâ”€â”€ ...
  â”œâ”€â”€ pages
  |   â”œâ”€â”€ home //home é¡µé¢
  |   |    â”œâ”€â”€ main.js
  |   |    â””â”€â”€ ...
  |   â””â”€â”€ about //about é¡µé¢
  |        â”œâ”€â”€ main.js
  |        â””â”€â”€ ...
  â””â”€â”€ ...

```

webpack.config.js ä¸­çš„é…ç½®

```js
// webpack.config.js
module.exports = {
  entry: {
    home: {"./src/pages/home/main.js"},
    about: "./src/pages/about/main.js",
  },
};
```

å¦‚æœä½¿ç”¨äº† vuecli3 è„šæ‰‹æ¶ï¼Œvue.config.js ä¸­çš„é…ç½®

```js
// vue.config.js
module.exports = {
  pages: {
    home: {
      // page çš„å…¥å£(ç›¸å¯¹äºé¡¹ç›®çš„æ ¹ç›®å½•)
      entry: `src/pages/home/main.js`,
      // å…¶ä»–é…ç½®é¡¹...
    },
    about: {
      // page çš„å…¥å£(ç›¸å¯¹äºé¡¹ç›®çš„æ ¹ç›®å½•)
      entry: `src/pages/about/main.js`,
      // å…¶ä»–é…ç½®é¡¹...
    },
  },
};
```

æœ€åä¼šå¯¹åº”çš„è¾“å‡º 2 ä¸ª html å’Œ 2 ä¸ªä¸»è¦ js

```code
  dist
  â”œâ”€â”€ home.html //å¼•å…¥äº†home.[hash].js
  â”œâ”€â”€ about.html //å¼•å…¥äº†about.[hash].js
  â””â”€â”€ assets
     â”œâ”€â”€ js
     |    â”œâ”€â”€ home.[hash].js //homeå…¥å£å½¢æˆçš„
     |    â”œâ”€â”€ about.[hash].js //aboutå…¥å£å½¢æˆçš„
     |    â””â”€â”€ ...
     â””â”€â”€ ...

```

#### å°ç»“ ğŸ€

æ¯ä¸ª entry ä¼šå¯¹åº”å½¢æˆä¸€ä¸ª chunk æœ€åæ‰“åŒ…å‡ºæ¥å¯¹åº”çš„ js å’Œ htmlã€‚entry ä¼šå¯¹åº”å½¢æˆ chunkï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸ºäº†æ‹†åˆ† chunk è€Œç”Ÿçš„ï¼Œå®ƒæ˜¯ä¸ºäº†æ„å»ºå¤šé¡µåº”ç”¨è€Œç”Ÿçš„ã€‚

> TIPS  
> entry.homeã€entry.about å¯ä»¥é…ç½®ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œæ”¯æŒçš„é€‰é¡¹ä¸æ‹†åˆ† chunk æ²¡å…³ç³»ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚

### import()

#### å¯¹åº”å…³ç³» ğŸ–‡ï¸

import() ä¸€ä¸ªå…·ä½“çš„è·¯å¾„ä¼šæŠŠè¯¥æ¨¡å—é™æ€å¼•å…¥çš„æ‰€æœ‰æ¨¡å—ä¸€èµ·æ‹†åˆ†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ chunkï¼›

import() ä¹Ÿå¯ä»¥æ˜¯å›ºå®šç›®å½•ä¸‹ï¼Œä¸å›ºå®šçš„æ–‡ä»¶ã€‚  
ä¾‹å¦‚ï¼Œ import(`src/skin/${color}.less`) ä¼šæŠŠ src/skin ç›®å½•ä¸­çš„æ¯ä¸ª .less æ–‡ä»¶æ‰“åŒ…åˆ°æ–°çš„ chunk ä¸­ã€‚åœ¨è¿è¡Œæ—¶ï¼Œè®¡ç®—å®Œå˜é‡ color åï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚

import() å¿…é¡»è‡³å°‘åŒ…å«ä¸€äº›å…³äºæ¨¡å—çš„è·¯å¾„ä¿¡æ¯ï¼Œæ‰“åŒ…å¯ä»¥é™å®šäºä¸€ä¸ªç‰¹å®šçš„ç›®å½•æˆ–æ–‡ä»¶é›†ã€‚ä¹Ÿå°±æ˜¯è¯´ import([å˜é‡]/xxx/xxx) æ˜¯ä¸å…è®¸çš„ï¼Œä½†æ˜¯ import([å¸¸é‡å­—ç¬¦ä¸²è·¯å¾„]/xxx/xxx) æ˜¯å…è®¸çš„ã€‚

#### ä¸¾ä¾‹è¯´æ˜ ğŸŒ°

å‡è®¾æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªå¤šçš®è‚¤çš„éœ€æ±‚ï¼Œæ¯æ¬¡åªéœ€è¦ç”¨åˆ°ä¸€å¥—çš®è‚¤ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹

```code
  src
  â”œâ”€â”€ main.js
  â”œâ”€â”€ ...
  â”œâ”€â”€ skin
  |   â”œâ”€â”€ green.less ç»¿è‰²ä¸»é¢˜æ ·å¼æ–‡ä»¶
  |   â””â”€â”€ blue.less è“è‰²ä¸»é¢˜æ ·å¼æ–‡ä»¶
  â””â”€â”€ ...

```

è¿™ç§æƒ…å†µå°±å¾ˆé€‚åˆç”¨ import() æŠŠæ¯ä¸ªä¸»é¢˜å½¢æˆä¸€ä¸ª chunk ç„¶åæŒ‰éœ€åŠ è½½

```js
function setSkin(skin) {
  import(`../../skin/${skin}/index.less`);
}
```

å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é­”æ³•æ³¨é‡Šå¯¹ä»£ç åˆ†å‰²åçš„ chunk æœ‰æ›´å¤šçš„æ§åˆ¶æƒï¼Œå¯é…ç½®é¡¹æœ‰:webpackIncludeã€webpackExcludeã€webpackChunkNameã€webpackModeã€webpackPrefetchã€webpackPreloadã€‚[é…ç½®é¡¹å«ä¹‰å’Œå¯æ¥æ”¶çš„å€¼çœ‹è¿™é‡Œ](https://webpack.docschina.org/api/module-methods/)
ï¼ˆimport()ä¸€ä¸ªå…·ä½“è·¯å¾„ï¼ŒwebpackIncludeã€webpackExclude ä¸å¯ç”¨ï¼‰

=================================================================

- webpackIncludeã€webpackExclude æ˜¯ç”¨æ¥å¯¹ç›®å½•ä¸‹æ–‡ä»¶è¿›è¡Œä¸€äº›ç­›é€‰è¿‡æ»¤ã€‚  
  æœ¬ä¾‹å¸Œæœ› skin ç›®å½•ä¸‹çš„æ‰€æœ‰ less æ–‡ä»¶éƒ½ä¼šè¢«æ‰“åŒ…ã€‚é»˜è®¤æƒ…å†µå°±æ˜¯ä¸è¿›è¡Œç­›é€‰ï¼Œå…¨éƒ¨å‚ä¸æ‰“åŒ…ï¼Œè¿™ä¸¤é¡¹å¯ä»¥ä¸é…ç½®ã€‚
- webpackChunkName ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶å‘½åã€‚  
  æœ¬ä¾‹è®¾ç½® webpackChunkName = "global-theme-"
- webpackMode æ˜¯ä¸æ‹†åˆ† chunk ç›¸å…³çš„ä¸€ä¸ªå…³é”®é…ç½®ã€‚æœ‰å››ä¸ªå€¼å¯é€‰
- - 'lazy' æ¯ä¸ªæ–‡ä»¶éƒ½ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„æ‡’åŠ è½½ chunkã€‚blue.less->blue.css,green.less->green.cssã€‚æ‡’åŠ è½½çš„å«ä¹‰åœ¨äºï¼Œæ‰§è¡Œ setSkin çš„æ—¶å€™æ‰å»åŠ è½½å…·ä½“çš„æ–‡ä»¶ã€‚
- - 'lazy-once' åªç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„æ‡’åŠ è½½ chunkã€‚ä¹Ÿå°±æ˜¯è¯´ blue.lessã€green.less ä¼šæ‰“åŒ…åˆ°ä¸€ä¸ª css æ–‡ä»¶ä¸­ã€‚æ‰§è¡Œ setSkin çš„æ—¶å€™æ‰å»åŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚
- - 'eager' ä¸ä¼šç”Ÿæˆç‹¬ç«‹çš„ chunkã€‚å¦‚æœ setSkin è¿™ä¸ªå‡½æ•°æ˜¯åœ¨ main.js ä¸­å®šä¹‰çš„ï¼Œé‚£ä¹ˆ blue.lessã€green.less ä¼šæ‰“åŒ…åˆ°ä¸»åŒ…ä¸­ã€‚
    > å€¼ä¸º 'eager' ä¸ é™æ€ import çš„åŒºåˆ«ï¼Ÿ
    > å¯¹äº less æ–‡ä»¶æ¥è¯´å’Œé™æ€çš„ import æ²¡æœ‰åŒºåˆ«ã€‚ä½†æ˜¯å¯¹äº js åˆ™è¡¨ç°ä¸ä¸€æ ·ï¼Œå‡è®¾ import() çš„æ˜¯ä¸€ä¸ª js æ–‡ä»¶ï¼Œé‚£ä¹ˆæ‰§è¡Œ setSkin çš„æ—¶å€™æ‰æŠŠè¯¥ js æ–‡ä»¶çš„å†…å®¹æ‰§è¡Œä¸€éã€‚

- - 'weak' å®˜ç½‘çš„è§£é‡Šæ²¡çœ‹æ‡‚ o(â•¥ï¹â•¥)oã€‚è‡ªå·±è¯•éªŒçš„è¿‡ç¨‹ä¸­å‘ç° green.less,blue.less æ²¡æœ‰è¢«æ‰“åŒ…è¿›ä¸»åŒ…ï¼Œä¹Ÿæ²¡æœ‰ç‹¬ç«‹å½¢æˆ chunkï¼Œè°ƒç”¨ setSkin çš„æ—¶å€™å‘ç”Ÿäº†æŠ¥é”™ã€‚

  é€šè¿‡ä¸Šé¢çš„åˆ†ææœ¬ä¾‹è®¾ç½® webpackMode = 'lazy' æ»¡è¶³ç‹¬ç«‹åˆ†åŒ…çš„éœ€æ±‚ã€‚é»˜è®¤é…ç½®å°±æ˜¯ 'lazy'ï¼Œæ‰€ä»¥è¿™é¡¹ä¹Ÿå¯ä»¥ä¸é…ç½®~

- webpackPrefetchã€webpackPreload ä¸æ‹†åˆ† chunk çš„å…³ç³»ä¸å¤§ï¼Œè¿™ä¸¤é¡¹ä¸»è¦æ˜¯å½±å“æ–‡ä»¶çš„åŠ è½½æ—¶æœºã€‚  
  æœ¬èŠ‚æœ«å°¾ä¼šç®€å•ä»‹ç»ä¸€ä¸‹åŒºåˆ«ï¼Œé»˜è®¤æ˜¯ webpackPrefetch:trueã€‚

=================================================================

æœ€åï¼Œåªè¦é…ç½®ä¸ªåå­—å°±å¯ä»¥äº†

```js
function setSkin(color) {
  /* webpackChunkName: "global-theme-" */
  import(`../../skin/${color}/index.less`);
}
```

è¿™æ ·ä½¿ç”¨åï¼Œæ‰“åŒ…å‡ºæ¥ä¸¤ä¸ªä¸»é¢˜æ–‡ä»¶ï¼Œåç§°ä¸º global-theme-0.cssã€global-theme-1.cssã€‚

```code
  dist
  â”œâ”€â”€ assets / css
  |   â”œâ”€â”€ global-theme-0.css
  |   â”œâ”€â”€ global-theme-1.css
  |   â””â”€â”€ ...
  â””â”€â”€ ...

```

åœ¨å…¥å£ html ä¸­å¼•ç”¨çš„æ–¹å¼

```html
<link href=assets/css/global-theme-green.css rel=prefetch> <link
href=assets/css/global-theme-blue.css rel=prefetch>
```

prefetch çš„è¡¨ç°ï¼šhtml åˆå§‹åŒ–æ—¶ï¼Œæœ¬èº«æ—¶æ²¡æœ‰å¼•å…¥ä¸»é¢˜æ ·å¼çš„ï¼Œå½“æ‰§è¡Œ setSkin å‡½æ•°çš„æ—¶å€™ï¼Œæµè§ˆå™¨å»åŠ è½½äº†å¯¹åº”çš„ css æ–‡ä»¶å†…å®¹ã€‚  
preload çš„è¡¨ç°ï¼šhtml åˆå§‹åŒ–æ—¶ï¼Œå°±å»åŠ è½½äº† css æ–‡ä»¶å†…å®¹ï¼Œå½“æ‰§è¡Œ setSkin å‡½æ•°çš„æ—¶å€™ï¼Œä½¿å¯¹åº”çš„ css æ–‡ä»¶ç”Ÿæ•ˆã€‚æ‰€ä»¥ç”¨ preload å¯èƒ½ä¼šæµªè´¹ä¸€å®šçš„è¯·æ±‚æ¬¡æ•°ã€‚

#### å°ç»“ ğŸ€

import() ä¼šæ‹†åˆ†å‡º chunkï¼Œä½†å®ƒæ˜¯ä¸ºäº†æŒ‰éœ€åŠ è½½è€Œç”Ÿçš„ï¼Œå®ƒä¹Ÿä¸æ˜¯ä¸“é—¨ä¸ºäº†æ‹†åˆ† chunk è€Œç”Ÿçš„ã€‚

### optimization.splitchunk

#### å¯¹åº”å…³ç³» ğŸ–‡ï¸

splitchunk æœ‰å¾ˆå¤šé…ç½®é¡¹ï¼Œå…¶ä¸­ **splitchunk.cacheGroups å¯¹è±¡ä¸­çš„æ¯ä¸€é¡¹å¯¹åº”ä¸€ä¸ª chunk**ã€‚

optimization.splitchunk æ˜¯ webpack4+ çš„ä¸€ä¸ªå†…ç½®æ’ä»¶ã€‚ï¼ˆwebpack4 ä¹‹å‰æ˜¯ CommonsChunkPluginï¼‰ã€‚  
splitchunk å¯ä»¥æ›´åŠ ç»†ç²’åº¦çš„æ‹†åˆ† chunkï¼Œå¯ä»¥å¯¹ entry å½¢æˆçš„åŒæ­¥ chunk å’Œ import()å½¢æˆçš„æŒ‰éœ€ chunkï¼Œå†è¿›è¡Œæ‹†åˆ†å’Œæå–ã€‚  
æ¯”å¦‚å¤šé¡µé¢åº”ç”¨çš„åœºæ™¯ä¸‹ï¼Œ å¤šä¸ªå…¥å£éƒ½å¼•ç”¨äº† echarts è¿™ç§æ¯”è¾ƒå¤§çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚æœ cacheGroup å¯¹è±¡ä¸ºç©ºï¼Œé‚£ä¹ˆæ¯ä¸ªå…¥å£å½¢æˆçš„ chunk éƒ½ä¼šåŒ…å«ä¸€ä»½ echarts çš„ä»£ç ã€‚  
webpack[é»˜è®¤æƒ…å†µ](https://webpack.docschina.org/plugins/split-chunks-plugin/#optimizationsplitchunks)ä¸‹ï¼ŒcacheGroup å·²ç»é…ç½®äº†ä¸¤ä¸ªç»„ï¼Œä½†æ˜¯ä¸ä½œç”¨äºå…¥å£å½¢æˆçš„ chunkã€‚å¦‚æœæ˜¯ä½¿ç”¨ vuecli3 è¿™æ ·çš„è„šæ‰‹æ¶ï¼Œå®ƒå¯¹ splitchunk åˆè¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå®ƒçš„é»˜è®¤æƒ…å†µ(è¡¥å……è¯´æ˜éƒ¨åˆ†)ä¼šæŠŠå…¥å£ chunk ä¸­çš„ echarts å’Œå…¶ä»–çš„ node_modules æ¨¡å—ä¸€èµ·æ‹†åˆ†å‡ºæ¥å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ chunkã€‚

#### ä¸¾ä¾‹è¯´æ˜ ğŸŒ°

å¯¹äºä»¥ä¸‹çš„ä¸€ä¸ªå¤šé¡µåº”ç”¨ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æŠŠ echarts å•ç‹¬æ‹†åˆ†ä¸ºä¸€ä¸ª chunk è¿›è€Œæ‰“åŒ…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

```code
  src
  â”œâ”€â”€ ...
  â”œâ”€â”€ pages
  |   â”œâ”€â”€ home
  |   |    â”œâ”€â”€ main.js ï¼ˆimport ./App.vueï¼‰
  |   |    â”œâ”€â”€ ...
  |   |    â””â”€â”€ App.vue ï¼ˆimport echartsï¼‰
  |   â””â”€â”€ about
  |        â”œâ”€â”€ main.js ï¼ˆimport ./App.vueï¼‰
  |        â”œâ”€â”€ ...
  |        â””â”€â”€ App.vue ï¼ˆimport echartsï¼‰
  â””â”€â”€ ...

```

æ ¹æ® cacheGroup ä¸ chunk çš„å¯¹åº”å…³ç³»ï¼Œå¤§æ¦‚çš„æ€è·¯

```js
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      //... é»˜è®¤
      cacheGroups: {
        //... é»˜è®¤
        // å¢åŠ 
         echarts: {
             // TODO å…·ä½“é…ç½®é¡¹
        },
      },
    }
  // ...
}

```

cacheGroup æœ‰å¾ˆå¤šï¼ˆå°†è¿‘ 20 ä¸ªï¼‰é…ç½®é¡¹ï¼Œ ä¸‹é¢ä»‹ç»æˆ‘åœ¨å®è·µè¿‡ç¨‹ä¸­ç”¨åˆ°çš„å‡ ä¸ª nameã€chunksã€testã€minChunksã€minSizeã€priorityã€‚ï¼ˆè¿˜æœ‰ä¸€äº›é…ç½®é¡¹æˆ‘ä¹Ÿè¿˜æ²¡æœ‰å­¦ä¹ çš„å¾ˆé€å½»ï¼Œå°±ä¸ä»‹ç»äº†ï¼‰

- name æ˜¯æ‰“åŒ…åçš„æ–‡ä»¶åã€‚å½“æˆ‘ä»¬è®¾ç½® name ä¸º chunk-echarts åï¼Œæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åæ˜¯ chunks-echarts.[hash].js

```js
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      //... é»˜è®¤
      cacheGroups: {
        //... é»˜è®¤
        // å¢åŠ 
         echarts: {
             name: "chunk-echarts",
        },
      },
    }
  // ...
}
```

chunks å’Œ test å…±åŒå†³å®šå“ªäº›æ¨¡å—ä¼šè¢«è¿™ä¸ªç¼“å­˜ç»„åŒ…æ‹¬è¿›æ¥ï¼Œæœ€åå½¢æˆä¸€ä¸ª chunkã€‚æ˜¯ä¸€ä¸ªâ€œé”å®šç›®æ ‡â€çš„ä½œç”¨ã€‚

- chunks å¯ä»¥é…ç½®ä¸ºå‡½æ•°æˆ–è€…æ˜¯ä¸‰ä¸ªç‰¹å®šçš„å€¼ï¼ˆ'initial'ã€'async'ã€'all'ï¼‰ã€‚  
  è®¾ç½®ä¸º initial ä»£è¡¨è¿™ä¸ªç¼“å­˜ç»„åªå¯¹å…¥å£å½¢æˆçš„ chunk èµ·ä½œç”¨ï¼Œè®¾ç½®ä¸º async åªå¯¹æŒ‰éœ€ import()å½¢æˆçš„ chunk èµ·ä½œç”¨ï¼Œè®¾ç½®ä¸º all åˆ™å¯ä»¥å…±äº«åŒæ­¥å’ŒæŒ‰éœ€çš„ chunkã€‚
  æœ¬ä¾‹ä¸­ï¼Œecharts æ˜¯é™æ€ import å¼•å…¥ï¼Œä¼šå­˜åœ¨äºå…¥å£å½¢æˆçš„ chunk ä¸­ï¼Œæ‰€ä»¥ chunks = initialã€‚
- test å€¼å¯ä»¥æ˜¯å‡½æ•°æˆ–è€…æ­£åˆ™ã€‚åœ¨ chunks é™åˆ¶ä¹‹ä¸Šï¼Œå†æ ¹æ®æ­£åˆ™ï¼ˆæˆ–å‡½æ•°ä¸­å®šä¹‰çš„æ¡ä»¶ï¼‰è¿›è¡Œæ¨¡å—åç§°çš„åŒ¹é…ã€‚  
  æˆ‘ä»¬å°±è¦åŒ¹é… echartsï¼Œæ‰€ä»¥è®¾ç½® test = /(echarts)/ ã€‚

ï¼ˆ[type é€‰é¡¹](https://webpack.docschina.org/plugins/split-chunks-plugin/#splitchunkscachegroupscachegrouptype)ä¹Ÿæ˜¯ç”¨æ¥é”å®šç›®æ ‡çš„ï¼Œæœ¬ä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œæš‚ä¸ä»‹ç»ï¼‰

```js
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      //... é»˜è®¤
      cacheGroups: {
        //... é»˜è®¤
        // å¢åŠ 
         echarts: {
             chunks: "initial", // ç”¨allä¹Ÿè¡Œ
             test: /(echarts)/,
        },
      },
    }
  // ...
}
```

é™¤æ­¤ä¹‹å¤–ï¼Œæ‹†åˆ† chunk è¿˜æœ‰ä¸€äº›å…¶ä»–é™åˆ¶ã€‚åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶æ‰èƒ½æˆåŠŸçš„æ‹†åˆ†å‡ºæ¥ chunk

- minChunks æ‹†åˆ†å‰å…±äº«çš„æœ€å° chunks æ•°ã€‚è¿™å…¶å®æ˜¯å¯¹ä½¿ç”¨é¢‘ç‡çš„ä¸€ä¸ªé™åˆ¶ï¼Œç»“åˆæœ¬ä¾‹å…·ä½“å±•å¼€è¯´æ˜æ˜¯è¿™æ ·çš„ï¼šecharts æ²¡æ‹†åˆ†å‡ºæ¥ä¹‹å‰è‡³å°‘è¢«åœ¨å‡ ä¸ª chunk æ‰€å…±äº«ï¼Ÿ  
  echarts æ‹†åˆ†å‰è¢« 2 ä¸ª chunk å…±äº«(æˆ‘ä»¬è®¾ç½®äº† chunks æ˜¯ initialï¼Œåªè€ƒè™‘ç”± entry å½¢æˆçš„ä¸¤ä¸ª chunkï¼Œhome å’Œ aboutï¼Œè¿™ä¸¤ä¸ªé‡Œé¢åˆ†åˆ«éƒ½ç”¨äº† echarts),æ‰€ä»¥ minchunk è®¾ç½®ä¸º 1 æˆ–è€… 2 éƒ½å¯ä»¥ã€‚é»˜è®¤å€¼æ˜¯ 1ï¼Œæ˜¯å¯ä»¥æ»¡è¶³éœ€æ±‚çš„ï¼Œè¿™ä¸€é¡¹å¯ä»¥çœç•¥é…ç½®ã€‚
- minSize æ‹†åˆ†åæœ€å°å­—èŠ‚æ•°ã€‚è¿™æ˜¯å¯¹ä½“ç§¯çš„ä¸€ä¸ªé™åˆ¶ï¼Œ  
  echarts æ‹†åˆ†å‡ºæ¥å‹ç¼©å‰>8kï¼Œæ‰€ä»¥ minsize å¯ä»¥è®¾ç½®ä¸ºæ¯” 8k å°çš„æ•°å­—å°±è¡Œã€‚é»˜è®¤å€¼æ˜¯ 20000ï¼Œæ˜¯å¯ä»¥æ»¡è¶³éœ€æ±‚çš„ï¼Œè¿™ä¸€é¡¹å¯ä»¥çœç•¥é…ç½®ã€‚
- splitChunks.maxInitialRequests ä¸å…¥å£ js æ–‡ä»¶å¹¶è¡ŒåŠ è½½çš„æ–‡ä»¶ä¸ªæ•°ï¼ˆåŒ…æ‹¬å…¥å£æ–‡ä»¶ï¼‰è¿›è¡Œé™åˆ¶ã€‚å¦‚æœæ‹†åˆ†çš„ chunk è¶…å‡ºè¿™ä¸ªæ•°ç›®ï¼Œä¼˜å…ˆä½“ç§¯å¤§çš„ chunk ç‹¬ç«‹æ‹†åˆ†å‡ºæ¥ã€‚  
  æœ¬ä¾‹ä¸­ï¼Œhome é¡µé¢ï¼Œä¸å…¥å£ home.js ä¸€èµ·åŠ è½½çš„æœ‰ node_moudles å½¢æˆçš„ chunkï¼Œecharts å½¢æˆçš„ chunkã€‚ä¸€å…±ä¸‰ä¸ªï¼Œæ‰€ä»¥ maxInitialRequests åº”è¯¥è®¾ç½®ä¸º>=3 çš„æ•°å­—ã€‚
- splitChunks.maxAsyncRequests å¯¹æŒ‰éœ€åŠ è½½å¹¶è¡Œæ¬¡æ•°è¿›è¡Œé™åˆ¶ã€‚å…¶ä»–è¦ç‚¹ä¸ maxInitialRequests æƒ³åŒã€‚
  > æ³¨æ„è¿™ä¸¤ä¸ªä¸æ˜¯å±äºæ¯ä¸ª cacheGroup çš„é…ç½®é¡¹ï¼Œæ˜¯ splitChunks çš„é…ç½®é¡¹ã€‚
- enforce æ˜¯ç”¨æ¥æ‰“ç ´é™åˆ¶çš„ï¼Œå‘Šè¯‰ webpack å¿½ç•¥ minChunksã€minChunksã€maxAsyncRequests å’Œ maxInitialRequests é€‰é¡¹ï¼Œå¹¶å§‹ç»ˆä¸ºæ­¤ç¼“å­˜ç»„åˆ›å»º chunkã€‚

```js
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      //... é»˜è®¤
      cacheGroups: {
        //... é»˜è®¤
        maxInitialRequests:5,
        // å¢åŠ 
         echarts: {
             chunks: "initial", // ç”¨allä¹Ÿè¡Œ
             test: /(echarts)/,
             // minChunks:1,//é»˜è®¤è¡Œä¸º
             // minsize:20000,//é»˜è®¤è¡Œä¸º
        },
      },
    }
  // ...
}
```

ä¼˜å…ˆçº§ç›¸å…³

- priority è¿™ä¸ªé…ç½®é¡¹æ˜¯ç”¨æ¥åè°ƒå„ä¸ªç¼“å­˜ç»„ä¹‹é—´çš„ä¼˜å…ˆçº§çš„ã€‚  
  é»˜è®¤æƒ…å†µä¸‹ webpack å·²ç»å†…ç½®äº†ä¸¤ç»„ç¼“å­˜  
  â‘  æ˜¯æ¥è‡ª node_modules ä¸­çš„æ¨¡å—ä¼šç‹¬ç«‹å‡ºä¸€ä¸ª chunkï¼Œè¿™ç»„çš„ä¼˜å…ˆçº§æ˜¯-10ã€‚
  â‘¡ æ˜¯è¢«é‡å¤ä½¿ç”¨ï¼ˆå¼•ç”¨æ¬¡æ•°>=2ï¼‰çš„æ¨¡å—ä¼šç‹¬ç«‹å‡ºä¸€ä¸ª chunkï¼Œè¿™ç»„çš„ä¼˜å…ˆçº§æ˜¯-20ã€‚  
  echarts å®ƒå³æ˜¯æ¥è‡ª node_modulesã€æ˜¯è¢«é‡å¤ä½¿ç”¨ã€ä¹Ÿæ˜¯æ»¡è¶³æˆ‘ä»¬è‡ªå®šä¹‰çš„ç¼“å­˜ç»„çš„ã€‚æˆ‘ä»¬è¦è®©å®ƒæœ€ç»ˆå½’å±äºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç¼“å­˜ç»„ï¼Œé‚£ä¹ˆ priority å°±è¦é«˜äº-10ã€-20ã€‚priority çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¤§äºé»˜è®¤ä¸¤ç»„çš„ä¼˜å…ˆçº§ï¼Œè¿™ä¸€é¡¹ä¹Ÿå¯ä»¥çœç•¥é…ç½®ã€‚

```js
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      //... é»˜è®¤
      maxInitialRequests:5,
      cacheGroups: {
        //... é»˜è®¤
        // å¢åŠ 
         echarts: {
             chunks: "initial", // ç”¨allä¹Ÿè¡Œ
             test: /(echarts)/,
             // minChunks:1,//é»˜è®¤è¡Œä¸º
             // minsize:20000,//é»˜è®¤è¡Œä¸º
             // priority: 0,//é»˜è®¤è¡Œä¸º
        },
      },
    }
  // ...
}
```

ä¸Šé¢æåˆ°çš„ cacheGroup ä¸­çš„é…ç½®é¡¹ï¼Œchunksã€maxAsyncRequestsã€maxInitialRequestsã€minChunksã€minSize ï¼Œä¹Ÿå¯ä»¥ä½œä¸º splitChunks çš„é…ç½®é¡¹è¿›è¡Œä¸€ä¸ªå…¨å±€é…ç½®ã€‚å½“ cacheGroup ä¸­æ²¡æœ‰é…ç½®çš„æ—¶å€™ï¼Œå°±ç”¨ splitChunks.xxx çš„å€¼ã€‚å¦‚æœ cacheGroup ä¸­é…ç½®äº†ï¼Œé‚£ä¹ˆå°±ç”¨ cacheGroup ä¸­é…ç½®çš„å€¼ã€‚  
è‡ªå®šä¹‰æ‹†åˆ† chunk åè¦åœ¨å…¥å£é…ç½®ä¸€ä¸‹ï¼Œè¿™æ ·æ‰èƒ½åœ¨ html ä¸­æ­£å¸¸å¼•å…¥ã€‚

```js
// vue.config.js
module.exports = {
  pages: {
    home: {
      // page çš„å…¥å£(ç›¸å¯¹äºé¡¹ç›®çš„æ ¹ç›®å½•)
      entry: `src/pages/home/main.js`,
      // å…¶ä»–é…ç½®é¡¹...
      // ä¸å…¥å£jsä¸€èµ·åŠ è½½çš„
      chunks: ["chunk-echarts", "chunk-vendors", "chunk-common", "home"], //é»˜è®¤æ˜¯['chunk-vendors', 'chunk-common', 'index']
    },
    about: {
      // page çš„å…¥å£(ç›¸å¯¹äºé¡¹ç›®çš„æ ¹ç›®å½•)
      entry: `src/pages/about/main.js`,
      // å…¶ä»–é…ç½®é¡¹...
      // ä¸å…¥å£jsä¸€èµ·åŠ è½½çš„
      chunks: ["chunk-echarts", "chunk-vendors", "chunk-common", "home"], //é»˜è®¤æ˜¯['chunk-vendors', 'chunk-common', 'index']
    },
  },
  chainWebpack: (webpackConfig) => {
    // å…¶ä»–é…ç½®...
    /* ä¸»åŠ¨åˆ† chunk */
    webpackConfig.optimization.splitChunks({
      cacheGroups: Object.assign(
        {},
        defaultCacheGroups,
        config.customCacheGroups
      ),
    });
  },
};
```

æ‰“åŒ…å chunk-echarts ä¼šåœ¨ dist/assets/js ä¸‹ã€‚å¹¶ä¸”ä¼šå’Œå…¥å£ js ä¸€èµ·åœ¨é¡µé¢å¯åŠ¨æ—¶å°±åŠ è½½ã€‚

#### å°ç»“ ğŸ€

å½“åŸå§‹ chunkï¼ˆentry å½¢æˆçš„ã€import()å½¢æˆçš„),éœ€è¦å†æ¬¡æ‹†åˆ†ä»¥ä¾¿äºæå–å‡ºå…¬å…±éƒ¨åˆ†æˆ–åˆ™å…¶ä»–ç”¨é€”å°±é€‚åˆæ´¾å‡º splitChunks å•¦ !

### è¡¥å……è¯´æ˜

- vuecli3 ä¸­ splitchunk çš„é»˜è®¤é…ç½®

```js
{
  cacheGroups: {
    vendors: {
      name: 'chunk-vendors',
      test: /[\\\/]node_modules[\\\/]/,
      priority: -10,
      chunks: 'async'
    },
    common: {
      name: 'chunk-common',
      minChunks: 2,
      priority: -20,
      chunks: 'async',
      reuseExistingChunk: true
    }
  }
}
```

## ç¤ºä¾‹ä½¿ç”¨

[ä»£ç åœ°å€](https://github.com/KittyFairy-Han/pluggable-MPA/tree/learning/webpack-chunk)

1. ä¸‹è½½åˆ°æœ¬åœ°
2. npm i
3. npm run build_test
4. æŸ¥çœ‹ dist æ–‡ä»¶å¤¹ï¼Œæ‰“åŒ…ç»“æœåº”è¯¥æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š

```code
  dist
  â”œâ”€â”€ home.html
  â”œâ”€â”€ about.html
  â””â”€â”€ assets
     â”œâ”€â”€ js
     |    â”œâ”€â”€ home.[hash].js //homeå…¥å£å½¢æˆçš„
     |    â”œâ”€â”€ about.[hash].js //aboutå…¥å£å½¢æˆçš„
     |    â”œâ”€â”€ chunk-echarts.[hash].js //é€šè¿‡splitchunkå¯¹echartsè¿›è¡Œäº†æ‹†åˆ†ï¼Œç‹¬ç«‹å‡ºä¸€ä¸ªæ–‡ä»¶
     |    â”œâ”€â”€ chunk-vendors.[hash].js //splitchunké»˜è®¤é…ç½®ä¸‹ï¼Œnode_modulesä¸­çš„æ¨¡å—ç‹¬ç«‹å‡ºä¸€ä¸ªæ–‡ä»¶
     |    â”œâ”€â”€ app-theme-0.[hash].js //é…åˆapp-theme-0.css
     |    â””â”€â”€ app-theme-1.[hash].js //é…åˆapp-theme-1.css
     â””â”€â”€ css
          â”œâ”€â”€ home.css //webpacké»˜è®¤é…ç½®ä¼šæŠŠå…¥å£jsä¸­çš„cssä»£ç å•ç‹¬æ‹†åˆ†å‡ºä¸€ä¸ªcssæ–‡ä»¶
          â”œâ”€â”€ about.css //webpacké»˜è®¤é…ç½®ä¼šæŠŠå…¥å£jsä¸­çš„cssä»£ç å•ç‹¬æ‹†åˆ†å‡ºä¸€ä¸ªcssæ–‡ä»¶
          â”œâ”€â”€ app-theme-0.css //é€šè¿‡import()åŠ¨æ€å¼•å…¥ä¸»é¢˜æ–‡ä»¶ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªç‹¬ç«‹çš„å¼‚æ­¥åŠ è½½æ–‡ä»¶
          â””â”€â”€ app-theme-1.css //é€šè¿‡import()åŠ¨æ€å¼•å…¥ä¸»é¢˜æ–‡ä»¶ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªç‹¬ç«‹çš„å¼‚æ­¥åŠ è½½æ–‡ä»¶
```

3. æœ¬åœ°æ‰“å¼€ home.htmlã€about.htmlã€‚èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ã€‚
   ![homeé¡µé¢](./static/home-init.png)
   ![abouté¡µé¢](./static/about-init.png)
4. home é¡µé¢ï¼Œæµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ setSkin('green')ã€‚èƒ½å¤Ÿåº”ç”¨ç»¿è‰²ä¸»é¢˜
   ![homeé¡µé¢åº”ç”¨ä¸»é¢˜](./static/home-theme.png)

## å‚è€ƒæ–‡æ¡£
[webpack](https://webpack.js.org/)   
