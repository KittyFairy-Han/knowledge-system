<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.14c2bce0.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.d16a662c.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.7cf7c029.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/59.fef4778a.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.381813e1.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.052e8931.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.98556ebc.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.c4d68806.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.ab0c784d.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.35333d85.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.2c542ec0.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.5684e216.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.df6acd3a.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.21ffb194.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.2f362b67.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.891d9b6a.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.af77dc42.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.6717cde1.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.a10b6a47.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.65e5120d.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.337b0fbd.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.55bbfbd3.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.181f16a4.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.58cb1b17.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.6de7b4e1.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.0acd95bd.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.e583dd2e.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.ac492911.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.91ef3a1e.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.82e3466a.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.62b5510e.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.a967023f.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.2ebc6660.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.5d827910.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.95dab843.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.67a40feb.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.7b2ac9c1.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.38813d4a.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.a58c3cbf.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.e4c6edc6.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.adbc8c00.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.11d87c62.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.f73f65d4.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.bf107409.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.86e08bfa.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.2ecdedbd.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.5c463317.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.f9e7c828.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.7b997a15.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.97deba30.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.2cef11c7.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.cb61564a.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.be532779.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.c45c8c57.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.85d4387d.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.6b0c6c11.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.ede6ee30.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.8d12cdcb.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.53b6461d.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.8b53f92a.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.38710412.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.3f0dc80d.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.8c6e3c12.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.6f79f7aa.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.84d4e14e.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.aa9be26d.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.542d9801.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.0a5c9c3e.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.65624e87.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.4f915ed9.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.e5dae1e4.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.65b17553.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.56ee3273.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.91cd9f9e.js"><link rel="prefetch" href="/knowledge-system/assets/js/76.67ee9843.js"><link rel="prefetch" href="/knowledge-system/assets/js/77.fc10727a.js"><link rel="prefetch" href="/knowledge-system/assets/js/78.0f358f40.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.31c234cc.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.b3b73ba9.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.14c2bce0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>模块化、组件化和设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/design/modularity.html" class="sidebar-link">模块化</a></li><li><a href="/knowledge-system/engineering/design/componential.html" class="sidebar-link">组件化</a></li><li><a href="/knowledge-system/engineering/design/design-pattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge-system/engineering/Vue/" class="sidebar-heading clickable"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/Vue/use.html" class="sidebar-link">使用</a></li><li><a href="/knowledge-system/engineering/Vue/principle.html" class="sidebar-link">原理</a></li><li><a href="/knowledge-system/engineering/Vue/Vue3.html" class="sidebar-link">Vue3</a></li><li><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html" class="sidebar-link">how-about-Vue3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/React/set-interval.html" class="sidebar-link">functional component中的setInterval</a></li><li><a href="/knowledge-system/engineering/React/react-etc.html" class="sidebar-link">react相关技术栈</a></li><li><a href="/knowledge-system/engineering/React/react-data-flow.html" class="sidebar-link">react数据流管理</a></li><li><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html" aria-current="page" class="active sidebar-link">redux的combineReducer和中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#react-redux-hooks-与-connect" class="sidebar-link">react-redux hooks 与 connect</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#使用对比" class="sidebar-link">使用对比</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#模拟-useselector-与-usedispatch" class="sidebar-link">模拟 useSelector 与 useDispatch</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#connect-与-hooks-对比" class="sidebar-link">connect 与 hooks 对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬" class="sidebar-link">🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#combinereducer" class="sidebar-link">combineReducer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#用法" class="sidebar-link">用法</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#原理" class="sidebar-link">原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#中间件" class="sidebar-link">中间件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#中间件公式" class="sidebar-link">中间件公式</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#小试牛刀-redux-thunk" class="sidebar-link">小试牛刀 redux-thunk</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#redux-saga-闪亮登场" class="sidebar-link">redux-saga 闪亮登场</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#使用示例" class="sidebar-link">使用示例</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/React/redux-combine-and-saga.html#原理-2" class="sidebar-link">原理</a></li></ul></li></ul></li></ul></section></li><li><a href="/knowledge-system/engineering/vdom/" class="sidebar-link">vdom</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/knowledge-system/engineering/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>没有废话！接着来 redux hooks</p> <h2 id="react-redux-hooks-与-connect"><a href="#react-redux-hooks-与-connect" class="header-anchor">#</a> react-redux hooks 与 connect</h2> <p>上面的 connect 真是够绕的哈 😅，我刚接触的时候也看傻 👀 了。connect 是高阶函数实现复用逻辑的思想，以前 react 还没有 hook 的时候实现逻辑复用也都是用这种方式进行逻辑注入，react 出了 hooks，react-redux 也提供了 hooks，用起来真是顺溜 😊 多了！</p> <h3 id="使用对比"><a href="#使用对比" class="header-anchor">#</a> 使用对比</h3> <ul><li>用 react-redux 的 connect :上文已提过，略</li> <li>用 react-redux 的 hooks : ByReactReduxHook</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;../styles.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reducer<span class="token punctuation">,</span> actions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**显示组件 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">ShowCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stateCount <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>count<span class="token operator">:</span><span class="token punctuation">{</span>stateCount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**操作组件 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">ChangeCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dispatchIncreatment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token constant">INCREASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dispatchDecreatment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token constant">DECREASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatchDecreatment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>➖<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatchIncreatment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>➕<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**======================================== */</span>
<span class="token keyword">const</span> <span class="token function-variable function">ByReactReduxHook</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>用 react<span class="token operator">-</span>redux hooks 做数据管理<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* 重要！ */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ShowCount <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ChangeCount <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ByReactReduxHook<span class="token punctuation">;</span>
</code></pre></div><p><em>Provider 还是那个 Provider，把 connect 这种 HOC 的方式换成 useSelector+useDispatch 这种 Hook 的方式了</em></p> <h3 id="模拟-useselector-与-usedispatch"><a href="#模拟-useselector-与-usedispatch" class="header-anchor">#</a> 模拟 useSelector 与 useDispatch</h3> <p>（其实还有 useStore 这个 hook，但不怎么用，不介绍了）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在上文中 简易模拟 react-redux 的 Provider 和 connect 代码后面追加</span>
<span class="token keyword">const</span> <span class="token function-variable function">useSelector</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>storeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectState <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> selectState <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// how to trigger component render？</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> selectState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">useDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>storeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="connect-与-hooks-对比"><a href="#connect-与-hooks-对比" class="header-anchor">#</a> connect 与 hooks 对比</h3> <p>hooks 优点</p> <ul><li>更容易理解、易上手、</li> <li>更符合 React Functional Component 的思想，官方也是推荐使用 hooks 的方式。</li> <li>例子中做了个小实验，渲染性能上也是 useSelector 更好
欢迎评论区说出 connect 比 hooks 好的点 😂</li></ul> <h2 id="🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬"><a href="#🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬" class="header-anchor">#</a> 🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬🌸🌟🍬</h2> <p>————————————————————————————————————————————————————————————————
碎碎念：<br>
本来初衷是想择优或者按业务场景推荐对应的 React 状态管理方案，但是发现了这个有来无回的 redux，都快忘了初衷了。<br>
但 redux 全家桶太丰（tao）富（yan）了，所以接下来还是继续 combineReducer、中间件。
————————————————————————————————————————————————————————————————
❕ 提示：<br> <a href="https://codesandbox.io/s/reactxue-xi-wz2rhs?file=/src/redux-extra/store/index.js" target="_blank" rel="noopener noreferrer">combineReducer,thunk 相关代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
下文列举关键代码，完整看 ⬅
————————————————————————————————————————————————————————————————</p> <h2 id="combinereducer"><a href="#combinereducer" class="header-anchor">#</a> combineReducer</h2> <h3 id="用法"><a href="#用法" class="header-anchor">#</a> 用法</h3> <h4 id="_1-定义不同的-reducer"><a href="#_1-定义不同的-reducer" class="header-anchor">#</a> 1.定义不同的 reducer</h4> <ul><li>countStore.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> countActionTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">INCREASE</span><span class="token operator">:</span> <span class="token string">&quot;INCREASE&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">DECREASE</span><span class="token operator">:</span> <span class="token string">&quot;DECREASE&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">countReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> countActionTypes<span class="token punctuation">.</span><span class="token constant">INCREASE</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> countActionTypes<span class="token punctuation">.</span><span class="token constant">DECREASE</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>todoStore.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  todoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> todoActionTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">CREATE</span><span class="token operator">:</span> <span class="token string">&quot;CREATE&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">FINISH</span><span class="token operator">:</span> <span class="token string">&quot;FINISH&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">todoReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> todoActionTypes<span class="token punctuation">.</span><span class="token constant">CREATE</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> todoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>todoList<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> todoActionTypes<span class="token punctuation">.</span><span class="token constant">FINISH</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        todoList<span class="token operator">:</span> state<span class="token punctuation">.</span>todoList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-combinereducer-函数"><a href="#_2-combinereducer-函数" class="header-anchor">#</a> 2.combineReducer 函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  countStates<span class="token operator">:</span> countReducer<span class="token punctuation">,</span>
  todoStates<span class="token operator">:</span> todoReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-业务中使用注意-mapstatetoprops-接受的参数"><a href="#_3-业务中使用注意-mapstatetoprops-接受的参数" class="header-anchor">#</a> 3.业务中使用注意 mapStateToProps 接受的参数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// state是rootState而不是某一个命名空间下的state</span>
  count<span class="token operator">:</span> state<span class="token punctuation">.</span>countStates<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>reducer 中的 state 是命名空间下的，而 mapStateToProps 接收的 state 是 rootState，因为 combineReducers 大概就是这样的一个函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 模拟 combineReducer
 * @param {object} object
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keyList <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">rootReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldRootState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newRootState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(&quot;oldRootState&quot;, oldRootState);</span>
    keyList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// dispatch一个action的时候，依次进入每个reducer，而不是进入命名空间下的某一个reducer</span>
      <span class="token keyword">const</span> reducer <span class="token operator">=</span> object<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// reducer中的state是命名空间下的state</span>
      <span class="token comment">// 因为依次进入每个action，所以action的type相同的时候，会命中多个reducer，需要人为控制action.type不同</span>
      <span class="token comment">// connect传入mapStateToProps的state是rootState</span>
      <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>oldRootState<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
      newRootState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(&quot;newRootState&quot;, newRootState);</span>

    <span class="token keyword">return</span> newRootState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> rootReducer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <h3 id="中间件公式"><a href="#中间件公式" class="header-anchor">#</a> 中间件公式</h3> <p>是一个三阶函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// next 是下一个中间件，如果只有一个中间件 next = store.dispatch</span>
<span class="token keyword">const</span> <span class="token function-variable function">thunk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 中间件中的逻辑如 log 等</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>业务层 dispatch 之后在 store 内部这样调用，所以公式是那个鬼（bushi）样子咯</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">someMiddleWare</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="小试牛刀-redux-thunk"><a href="#小试牛刀-redux-thunk" class="header-anchor">#</a> 小试牛刀 redux-thunk</h3> <p>redux-thunk 作为一个中间件的入门极好！写一个类似 redux-thunk 的中间件，实现 dispatch 后可以异步</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">thunk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">,</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>用用看咯</p> <ol><li>applyMiddleware</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 关键代码就是在 createStore 时 applyMiddleware(thunk)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>mapDispatchToProps 添加一个异步的 dispatch</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 新增</span>
  <span class="token function-variable function">dispatchGetListAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> todoActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> list <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ....</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>List 组件调用 dispatchGetListAsync</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">dispatchGetListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><h2 id="redux-saga-闪亮登场"><a href="#redux-saga-闪亮登场" class="header-anchor">#</a> redux-saga 闪亮登场</h2> <h3 id="使用示例"><a href="#使用示例" class="header-anchor">#</a> 使用示例</h3> <p>对比 thunk 更改点：</p> <ol><li>配置 saga</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 新增 store/todoSaga.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> takeEvery<span class="token punctuation">,</span> all <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux-saga/effects&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getTodoList <span class="token keyword">from</span> <span class="token string">&quot;../mocks/getTodoList&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> todoActionTypes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./todoStore&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">initTodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> todoList <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>getTodoList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//模拟接口请求</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> todoActionTypes<span class="token punctuation">.</span><span class="token constant">INIT</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> todoList <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">todoSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;INIT_TODO_LIST&quot;</span><span class="token punctuation">,</span> initTodoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>与 thunk 不同的是，createSagaMiddleware 与 sagaMiddleware.run(todoSaga)</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 改造 store/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore<span class="token punctuation">,</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createSagaMiddleware <span class="token keyword">from</span> <span class="token string">&quot;redux-saga&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> todoSaga <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./todoSaga&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> countActionTypes<span class="token punctuation">,</span> countReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./countStore&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> todoReducer<span class="token punctuation">,</span> todoActionTypes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./todoStore&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  countStates<span class="token operator">:</span> countReducer<span class="token punctuation">,</span>
  todoStates<span class="token operator">:</span> todoReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sagaMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个实例</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sagaMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>todoSaga<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//run我们写的saga</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> countActionTypes<span class="token punctuation">,</span> todoActionTypes <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>dispatch saga 中定义的类型，异步请求逻辑已经挪到 saga 中，dispatch 更清爽</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 改造 components/List.jsx</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">dispatchGetListAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只有 dispatchGetListAsync 做了更改</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;INIT_TODO_LIST&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ....</span>
</code></pre></div><h3 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h3> <p>源码太太太复杂了！争取补个流程图！真的能摸透了单独写一篇吧！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/knowledge-system/engineering/React/react-data-flow.html" class="prev">
        react数据流管理
      </a></span> <span class="next"><a href="/knowledge-system/engineering/vdom/">
        vdom
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.d16a662c.js" defer></script><script src="/knowledge-system/assets/js/2.7cf7c029.js" defer></script><script src="/knowledge-system/assets/js/59.fef4778a.js" defer></script>
  </body>
</html>
