<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.c0d58452.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.9a1ee131.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.23e8f8fa.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/6.0bde10b4.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.d297245e.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.28070aae.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.8d7112dc.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.e4263515.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.79be9d0e.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.3b0283b0.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.2c542ec0.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.eca408d8.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.d76e974d.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.49c6ca6a.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.2f362b67.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.891d9b6a.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.f17721f1.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.6717cde1.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.7e6c3ff5.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.a0377bc6.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.fc00b2c2.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.9b3b1d47.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.40b4b82c.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.390cfb03.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.071290b9.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.a32c7810.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.667e8bf9.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.fc455274.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.91ef3a1e.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.82e3466a.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.921aa028.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.e26e1512.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.2ebc6660.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.5d827910.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.95dab843.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.bdb6f232.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.7b2ac9c1.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.5861da4a.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.4ba289ee.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.c37dbe8c.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.35f2a616.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.5a0297ea.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.0f2cde54.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.0648d7e4.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.4abb3504.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.d748d684.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.4343c4fc.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.3b89cfa0.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.3efb5851.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.bb2d0cff.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.028c9a4c.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.2febd880.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.be532779.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.fef5ba63.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.17628ac8.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.a0275943.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.5c7852a5.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.b3e708b4.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.36d25471.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.930509d3.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.99605edf.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.0be91e9e.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.e11a7f45.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.b9059598.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.1ff13b3b.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.22182db2.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.5b6bae3f.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.793cfd75.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.4c229c2f.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.d8964086.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.fe90d86d.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.67042879.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.1bc92ed7.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.11f7b7f7.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.62102bae.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.ac36915c.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.c0d58452.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>模块化、组件化和设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/design/modularity.html" class="sidebar-link">模块化</a></li><li><a href="/knowledge-system/engineering/design/componential.html" class="sidebar-link">组件化</a></li><li><a href="/knowledge-system/engineering/design/design-pattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge-system/engineering/Vue/" class="sidebar-heading clickable router-link-active open"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/Vue/use.html" class="sidebar-link">使用</a></li><li><a href="/knowledge-system/engineering/Vue/principle.html" class="sidebar-link">原理</a></li><li><a href="/knowledge-system/engineering/Vue/Vue3.html" class="sidebar-link">Vue3</a></li><li><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html" aria-current="page" class="active sidebar-link">how-about-Vue3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#使用体验方面" class="sidebar-link">使用体验方面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#支持-ts" class="sidebar-link">支持 ts</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#逻辑聚合" class="sidebar-link">逻辑聚合</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#逻辑复用完善" class="sidebar-link">逻辑复用完善</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#响应式改写" class="sidebar-link">响应式改写</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#性能-初始化速度" class="sidebar-link">性能-初始化速度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#响应式" class="sidebar-link">响应式</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#性能-更新速度" class="sidebar-link">性能-更新速度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#与-react-更新性能总体对比" class="sidebar-link">与 React 更新性能总体对比</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#template-预字符串化" class="sidebar-link">template 预字符串化</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#静态标记、静态提升与事件缓存" class="sidebar-link">静态标记、静态提升与事件缓存</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#diff-算法内部优化" class="sidebar-link">diff 算法内部优化</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#响应式-2" class="sidebar-link">响应式</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#体积" class="sidebar-link">体积</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html#vue-tree-shaking" class="sidebar-link">Vue tree shaking</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/React/set-interval.html" class="sidebar-link">functional component中的setInterval</a></li><li><a href="/knowledge-system/engineering/React/react-etc.html" class="sidebar-link">react相关技术栈</a></li></ul></section></li><li><a href="/knowledge-system/engineering/vdom/" class="sidebar-link">vdom</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/knowledge-system/engineering/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3-优化-react-对比"><a href="#vue3-优化-react-对比" class="header-anchor">#</a> Vue3 优化（React 对比）</h1> <p>这次主要是想和大家介绍 Vue3 的优点。因为大家对 Vue2 都有基础了，所以会以 Vue2 为基础来说它的用法改变和性能提升。遇到与 React 思想相同，或者用法相似的地方，也会与 React 做比较。<br>
内容上，只会说设计思路，尽量配图，通俗易懂的让大家了解到它优秀的地方。不会上升到源码讲解，因为每个点细节的去讲都值得一整篇文章了。</p> <h2 id="使用体验方面"><a href="#使用体验方面" class="header-anchor">#</a> 使用体验方面</h2> <p>相比较 React，Vue2.x 使用上有一些缺点。<br>
1️⃣ 对 ts 弱支持<br>
2️⃣ 功能点的数据和逻辑分散：Vue2.x 是选项配置式（Options API）的写法<br>
3️⃣ 组件化不彻底：纯逻辑复用不优雅，mixin 痛点较多<br>
4️⃣ 响应式不完善：检测不到对象属性的添加和删除、无法监控到数组下标的变化<br>
在 Vue3 中，这些缺点都改掉了，甚至比 React 做的更好。</p> <h3 id="支持-ts"><a href="#支持-ts" class="header-anchor">#</a> 支持 ts</h3> <p>Vue3.x 用 ts 重写，对 ts 支持友好。🎉🎉🎉</p> <h3 id="逻辑聚合"><a href="#逻辑聚合" class="header-anchor">#</a> 逻辑聚合</h3> <p>Vue3 中使用 Composition API 使逻辑更加聚合。<br>
官方示例：<br> <img src="/knowledge-system/assets/img/composition.a7ec5749.jpg" alt="Vue3.x逻辑分布散">
每个颜色代表一个功能点，<br>
在 Vue2.x 中以 Options API 的形式分布。每个功能点的数据在 data 中定义，也可能存在与 computed 中。功能点的逻辑可能分散 methods，watch 等 option 中。<br>
在 Vue3.x 中以 Composition API 的形式分布，每个功能点的数据逻辑聚合到一个代码区域。</p> <h4 id="🌰-composition-api-使用"><a href="#🌰-composition-api-使用" class="header-anchor">#</a> 🌰 Composition API 使用</h4> <p>来看一下 vue3 中 data、computed、methods、watch、生命周期函数的用法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 类似 data */</span>
  <span class="token keyword">const</span> greetings <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;unknow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* computed */</span>
  <span class="token keyword">const</span> greetingLen <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> greetings<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* methods */</span>
  <span class="token keyword">const</span> <span class="token function-variable function">updateGreeting</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    greetings<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token string">&quot;Hello &quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">/* watch */</span>
  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">greetings，</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">updating </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>greetings<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    greetings，
    greetingLen，
    updateGreeting，
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="逻辑复用完善"><a href="#逻辑复用完善" class="header-anchor">#</a> 逻辑复用完善</h3> <p>Vue3.x 中也采用了 Hook 的思想，使用 Hook 更利于逻辑复用。<br>
在 Vue2.x 中，纯逻辑复用会采用 mixin 的方式，mixin 是代码注入，所以与使用它的组件之间存在隐式依赖，可能产生命名冲突等，降低了应用的可预测性。<br>
Hooks 不是注入代码片段，类似一个独立的实例，不会与引入它的组件代码发生耦合或者覆盖，也不能更改组件传递给它的属性。并且多个 Hooks 之间可以串联使用，也可以相互调用。
<img src="/knowledge-system/assets/img/hooks.62436d29.png" alt="Vue3.x组件化更清晰">
Vue Hooks 不仅是对 mixin 的一种替代升级方案，而且 Vue Hooks 规避了一些 React Hooks 的使用上的限制和麻烦之处。<br>
1️⃣ React Hooks 必须在顶层调用，不能在条件语句使用。Vue Hooks 的使用没有这些限制，只把它当成一个普通的函数用就 ok。</p> <blockquote><p>React 的 Hook 底层是链表，每一个 Hook 的 next 是指向下一个 Hook 的，if 会导致顺序不正确，从而报错，所以 react 是不允许这样使用 Hook 的。</p></blockquote> <p>2️⃣ React Hooks 有时需要手动使用 useCallback，useMemo 去优化，避免子组件无必要的重新渲染。Vue 是不需要开发人员去考虑这些手动优化的。</p> <blockquote><p>Vue 的组件渲染是基于响应式的，内部做了细粒度的监听机制，不会产生无必要的子组件重新渲染。</p></blockquote> <p>3️⃣ React 会在每次渲染都执行一遍 Hooks ， 可能导致性能不佳。Vue Hooks 只在初始化执行。</p> <blockquote><p>React 我们定义的是渲染函数，Vue 我们定义的是组件，在 setup 中 使用 Hooks，setup 只会在初始化时执行一次，所以 Vue Hooks 每次渲染时都重复执行。</p></blockquote> <h4 id="🌰-vue-hooks-的例子"><a href="#🌰-vue-hooks-的例子" class="header-anchor">#</a> 🌰 Vue Hooks 的例子</h4> <p>实现一个 Hooks，检查是否在目标元素以外进行点击。应用场景：点击下拉框的以外的任意位置关闭下拉框。<br> <strong>Hook 内部代码</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref， onMounted， onUnmounted， Ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// elementRef 目标元素</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">elementRef<span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token keyword">null</span> <span class="token operator">|</span> HTMLElement<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义一个状态表示是否在元素外点击</span>
  <span class="token keyword">const</span> isClickOutside <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token operator">:</span> MouseEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>elementRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isClickOutside<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        isClickOutside<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// Hook 被注册时开启监听</span>
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span>， handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Hook 被注销时移除监听</span>
  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span>， handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 把状态传递给父级组件</span>
  <span class="token keyword">return</span> isClickOutside<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>组件中应用 Hook</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> useClickOutside <span class="token keyword">from</span> <span class="token string">&quot;../Hooks/useClickOutside&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// ....</span>
<span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ....</span>
  <span class="token keyword">const</span> dropdownRef <span class="token operator">=</span> <span class="token punctuation">(</span>ref <span class="token operator">&lt;</span> HTMLElement<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">&gt;</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isClickOutside <span class="token operator">=</span> <span class="token function">useClickOutside</span><span class="token punctuation">(</span>dropdownRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">isClickOutside，</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isClickOutside<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> isOpen<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 打开状态下，点击非目标元素和它的孩子节点则关闭目标元素</span>
      isOpen<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    isOpen，
    isClickOutside，
    dropdownRef，
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="响应式改写"><a href="#响应式改写" class="header-anchor">#</a> 响应式改写</h3> <p>Proxy 代替 Object.defineProperty ，得益于 Proxy 原生能力，可以劫持对象增删属性、数组下标变化。🎉🎉🎉</p> <p>在 Vue2.x 中如果想要监听对象增删属性，需要使用 Vue 的静态方法，Vue.set、Vue.delete。对于 Vue3 来说，不需要这种补丁写法了。 Vue2.x 中响应式数据是通过 data(){} 这个 Option 返回的。<br>
Vue3 中响应式数据是在初始化时（setup 函数）通过 ref API 或者 reactive API 定义的，然后作为 setup 的返回值。</p> <h4 id="🌰-响应式数据基本用法"><a href="#🌰-响应式数据基本用法" class="header-anchor">#</a> 🌰 响应式数据基本用法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 通过下标更改数组的值 */</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>， <span class="token number">1</span>， <span class="token number">2</span>， <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> i <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> v <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      list<span class="token punctuation">.</span>value<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span> <span class="token comment">//更改下标可以响应</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">/* 为对象增添属性 */</span>
    <span class="token keyword">const</span> obj<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;语文&quot;</span>， score<span class="token operator">:</span> <span class="token string">&quot;98&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> k <span class="token operator">=</span> <span class="token string">&quot;prop-&quot;</span> <span class="token operator">+</span> index<span class="token punctuation">;</span>
      <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token string">&quot;value-&quot;</span> <span class="token operator">+</span> index<span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>value<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span> <span class="token comment">//直接添加就可以响应</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 用于template渲染</span>
      list，
      changeList，
      obj，
      changeObj，
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>，
</code></pre></div><p>可以通过<a href="https://codesandbox.io/s/pedantic-lehmann-3mw88?file=/src/App.vue" target="_blank" rel="noopener noreferrer">这个在线例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来查看完整代码，以验证。</p> <h2 id="性能-初始化速度"><a href="#性能-初始化速度" class="header-anchor">#</a> 性能-初始化速度</h2> <h3 id="响应式"><a href="#响应式" class="header-anchor">#</a> 响应式</h3> <p>Object.defineProperty 只能劫持对象的属性， 所以在 Vue.js 2.x 中，对于一个深层属性嵌套的对象，要劫持它内部深层次的变化，就需要在<strong>Vue 实例初始化的时候递归遍历</strong>这个对象，执行 Object.defineProperty 把每一层对象数据都变成响应式的。
<img src="/knowledge-system/assets/img/Proxy_Vue2.82715205.png" alt="Vue2 数据劫持"></p> <p>Proxy 是对象层的劫持，在 Vue.js 3.x 中，初始化一个响应式数据时不会直接进行深层递归调用，<strong>递归调用是发生在 getter 的时候</strong>，也就是说只有属性被使用了才会进一步的深层调用。这其实是一种延时定义子对象响应式的实现，在性能上会有一定的提升。
<img src="/knowledge-system/assets/img/Proxy_Vue3.91583934.png" alt="Vue3 数据劫持"></p> <p>实验数据可以参考<a href="https://www.yuque.com/hugsun/Vue3/perf" target="_blank" rel="noopener noreferrer">这个<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="性能-更新速度"><a href="#性能-更新速度" class="header-anchor">#</a> 性能-更新速度</h2> <p>Vue 和 React 两者都具有数据驱动视图的思想，也都用到了 VDOM，对流程最简洁的概括： data-&gt;VDOM-&gt;DOM-&gt;view ，这个流程本质上就是 js 执行。js 执行要考虑性能问题，因为 js 执行期间会一直占据着 CPU，如果时间过长，一则会导致用户触发的事件得不到响应， 二则会导致掉帧即阻塞浏览器渲染，用户的角度去感知就是卡顿。<br>
解决这种由于 js 执行时间过长导致卡顿的问题 Vue3 和 React 走了不同的路。</p> <h3 id="与-react-更新性能总体对比"><a href="#与-react-更新性能总体对比" class="header-anchor">#</a> 与 React 更新性能总体对比</h3> <h4 id="react-的思路-cpu-总运算量不变-利用时间切片的思想-做到快速响应用户-让用户觉得够快。"><a href="#react-的思路-cpu-总运算量不变-利用时间切片的思想-做到快速响应用户-让用户觉得够快。" class="header-anchor">#</a> React 的思路：CPU 总运算量不变，利用时间切片的思想，做到快速响应用户，让用户觉得够快。</h4> <p>所以 React 走了类似 CPU 调度的逻辑，让 整个更新流程 可以中断。把 VDOM tree，设计成链表的结构，利用浏览器的空闲时间来做数据驱动视图更新的流程，如果有动画或者用户交互的任务，就把主进程控制权还给浏览器。这就像 CPU 调度进程一样，我们要让高优先级的进程或者短进程优先运行，不能让长进程长期霸占资源。</p> <blockquote><p>核心是应用了这个原生 API ：requestIdleCallback。链表数据结构 ：Fiber</p></blockquote> <p><img src="/knowledge-system/assets/img/fiber-1.8c789c50.png" alt="React VDOM"></p> <p>链表结构的形成是基于树的深度优先遍历</p> <p><img src="/knowledge-system/assets/img/fiber-2.6ef736a2.png" alt="React VDOM"></p> <h4 id="vue3-的思路-优化每个任务-让它有多快就多快-达到挤压-cpu-总运算量的目的-废除了时间切片的思路-。"><a href="#vue3-的思路-优化每个任务-让它有多快就多快-达到挤压-cpu-总运算量的目的-废除了时间切片的思路-。" class="header-anchor">#</a> Vue3 的思路：优化每个任务，让它有多快就多快，达到挤压 CPU 总运算量的目的（废除了时间切片的思路）。</h4> <p>根据尤大公布的数据就是 Vue3 update 性能提升了 1.3~2 倍，具体优化点下面小节介绍。</p> <blockquote><p>为什么移除时间切片呢？因为每个任务极致优化后，cpu 总运算量降低，已经不需要时间切片了。 尤大亲自解释可以看<a href="https://github.com/Vuejs/rfcs/issues/89" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="为什么会走不同的路呢"><a href="#为什么会走不同的路呢" class="header-anchor">#</a> 为什么会走不同的路呢？</h4> <p>React 和 Vue 虽然都有 data-&gt;VDOM-&gt;DOM-&gt;view 这样的转换思想，但具体的数据驱动的原理不同。<br>
当数据改变时， React 会递归比对整个新旧 VirtualDOM 树，找出需要变动的节点，然后一气呵成的更新。所以对于 React 来说，js 执行时间长主要就在于新旧 VDOM tree 对比时间长，就算 diff 算法再快也避免不了这个过程长，所以 React 走了时间切片的思路。</p> <p>Vue 与 React 不同的数据驱动更新机制让 Vue 有更多的优化空间：<br>
1️⃣ 在组件级别采用的是响应式的机制，可以让更新精确地定位到具体的组件（不需要整棵树对比），响应式有一定的优化空间<br>
2️⃣ 组件内部使用的是 VDOM diff，并且是边对比变更新，不是一气呵成。diff 算法可以进一步优化。<br>
3️⃣ 使用模板相比 JSX，易于静态分析(AOT)，也让它有更多优化的空间。</p> <blockquote><p>React 也可以做组件树级别的优化(即防止不必要的子组件重新呈现)需要显式使用 usemo，但是用好 usemo 不是一件容易的事。</p></blockquote> <h3 id="template-预字符串化"><a href="#template-预字符串化" class="header-anchor">#</a> template 预字符串化</h3> <p>通过 template 预字符串化使 VDOM 节点数量减少，DOM tree 结构变得简单，遍历时间缩短。<br>
Vue3 模板编译的时候会去识别动/静比例，当遇到大量连续的静态内容时，会直接将他编译为一个普通的字符串节点。</p> <p>🌰 比如这样的代码片段</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>menu-bar-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>菜单项 1 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>菜单项 2 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      ...
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>菜单项 19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>菜单项 20<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{user.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>除了 span 元素是动态元素之外，其余都是静态节点。在编译阶段，会把连续的静态元素部分合并为字符串。对比 vue2.x 来看如图：
<img src="/knowledge-system/assets/img/template_stringfy.e8340ac5.png" alt="template与字符串化"></p> <h3 id="静态标记、静态提升与事件缓存"><a href="#静态标记、静态提升与事件缓存" class="header-anchor">#</a> 静态标记、静态提升与事件缓存</h3> <p>创建 VDOM 的时候会根据 VDOM 的内容是否可以变化，为其添加静态标记 PatchFlag，如果 patchFlag = -1 表示当前节点是静态的，永远不会用作 diff。应用静态标记，大大的减少了 diff 工作量，剪短 diff 算法运行的时间。<br>
静态提升是指标记为静态的节点，会缓存在 render 函数之外，创建 VDOM 的时候直接引用，不需要重新创建。</p> <p>🌰 用下面的代码举例</p> <div class="language-Vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guide<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      进入主页
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>你好,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ user.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>span 元素 这行代码是静态的，在没有静态标记的时候，每次 diff 它也会参与，渲染之前总是会被重新创建。<br>
加入静态标记后，它就不用参加 diff 流程了。<br>
有了静态提升之后，假设内存中_hosted_1 这个变量代表 span 元素的 VDOM，每次渲染的时候只要取 _hoisted_1 即可。</p> <p><img src="/knowledge-system/assets/img/vdom_diff.4d462475.png" alt="Vue3 diff"></p> <h4 id="事件侦听缓存"><a href="#事件侦听缓存" class="header-anchor">#</a> 事件侦听缓存</h4> <p>与 VDOM 静态提升相似，事件的回调函数，通常都是不变的。这种情况下，函数会被缓存起来，不用追踪它的变化。事件响应时，直接从内存中取出函数执行。</p> <blockquote><p>疑问: 静态标记静态提升，React 为啥不做呢?</p></blockquote> <h3 id="diff-算法内部优化"><a href="#diff-算法内部优化" class="header-anchor">#</a> diff 算法内部优化</h3> <p>算法复杂，很难抽象出流程图。简单列一下区别和性能对比：<br>
React 的 DOM tree 是链表结构，注定只能从单边开始比较，原地复用、下标递增法移动复用。<br>
Vue2 双端比较，比较时总共有五种情况（四种相等＋一种不相等），分别做不同的处理。相比 React，双端比较更能节约次数。<br>
Vue3 先双端比较，原地复用。然后最长递增子序列移动复用。(最长递增子序列使用的是“贪心 + 二分查找”的算法)。比 Vue2 更快。</p> <h3 id="响应式-2"><a href="#响应式-2" class="header-anchor">#</a> 响应式</h3> <p>从 Vue2.x 到 Vue3.0，响应式改写提升了初始化性能上面已经说过了。从 3.0 到 3.2，响应式进一步优化，更新性能进得到了显著提升。<br>
官方数据：依赖跟踪速度提升约 40%、ref 读取速度提升约 260%，写入速度提升约 50%。</p> <p>响应式的优化是代码细节的优化，大概思想也是用空间换时间。增加几个标记，并且巧妙的运用位运算。推荐阅读<a href="https://juejin.cn/post/6995732683435278344" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><small><i>PS:真滴难！/(ㄒ o ㄒ)/~~ ，希望有朝一日看得明明白白、真真切切。</i></small></p> <h2 id="体积"><a href="#体积" class="header-anchor">#</a> 体积</h2> <h3 id="vue-tree-shaking"><a href="#vue-tree-shaking" class="header-anchor">#</a> Vue tree shaking</h3> <p>源码支持 tree shaking，打包体积变小。之前时引入整个 Vue 、现在是引入 Vue 中的 各个 API 组合使用，没用到的就不会打包。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/knowledge-system/engineering/Vue/Vue3.html" class="prev">
        Vue3
      </a></span> <span class="next"><a href="/knowledge-system/engineering/React/set-interval.html">
        functional component中的setInterval
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.9a1ee131.js" defer></script><script src="/knowledge-system/assets/js/2.23e8f8fa.js" defer></script><script src="/knowledge-system/assets/js/6.0bde10b4.js" defer></script>
  </body>
</html>
