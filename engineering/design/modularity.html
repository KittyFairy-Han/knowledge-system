<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块化</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.c0d58452.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.7767ddcb.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.03bbdc7f.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/64.68020544.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.d81212ca.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.3d651253.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.f5d3837a.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.84b4711b.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.c2e4b845.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.3c0de0b0.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.73a73121.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.687c2ce6.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.8418e663.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.167f4279.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.12d00110.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.6f9335b7.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.a70962ed.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.b44c74a6.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.9ea2eee2.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.a0377bc6.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.ce89e263.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.1ba24be8.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.a94c0aef.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.ad464842.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.db53d47e.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.28b23341.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.c5368048.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.ac492911.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.91ef3a1e.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.fdbeaa17.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.8abd6f8f.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.519b859b.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.57c9db6c.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.bc41eef4.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.7fcbbe3f.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.8435095a.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.7c2033b3.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.f231bfd4.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.30468908.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.aef23bac.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.2bafce25.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.f75d1aef.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.b3a3ccec.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.6aa64d23.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.7d869b54.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.7ca5d097.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.2a124596.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.6879d1ea.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.7066d56d.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.e6f65fd5.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.28e753d8.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.5051a828.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.c81ccece.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.58341fca.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.a8d6247e.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.5677eaff.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.4b40f2dc.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.1fddb7ab.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.b3e708b4.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.640360e9.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.1fe1a237.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.c776fab3.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.f1d7cd5a.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.30684cbf.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.0ed0a587.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.77a7f011.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.81bbdcfc.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.5f112b30.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.93e32d38.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.270addde.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.0719f388.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.bc6ef3c6.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.a76fa047.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.0624cb9d.js"><link rel="prefetch" href="/knowledge-system/assets/js/76.792177d4.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.2e1f0fcc.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.4b09bdb4.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.c0d58452.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>模块化、组件化和设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/design/modularity.html" aria-current="page" class="active sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#为什么要用模块" class="sidebar-link">为什么要用模块</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#发展" class="sidebar-link">发展</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#一、moudle-exports、require" class="sidebar-link">一、moudle.exports、require</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_1-使用" class="sidebar-link">1.  使用</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_2-原理" class="sidebar-link">2.  原理</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_3-两种导出写法对比" class="sidebar-link">3.两种导出写法对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#二、es6-标准语法-export-和-import" class="sidebar-link">二、ES6  标准语法  export  和  import</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_1-使用-2" class="sidebar-link">1.  使用</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_2-原理-2" class="sidebar-link">2.  原理</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_3-export-default-xxxx、import-xxx-from、import-as-xxx-from" class="sidebar-link">3. export default xxxx、import xxx from、import * as xxx from</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#三、commonjs和es6-混用" class="sidebar-link">三、CommonJS和ES6  混用</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#四、两种规范-有什么区别" class="sidebar-link">四、两种规范，有什么区别？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#require-循环加载" class="sidebar-link">require()  循环加载</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_1-import-在编译时加载-require-在运行时加载" class="sidebar-link">1. import  在编译时加载，require  在运行时加载</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_2-import-命令的那一行代码不论写在哪里-都会提前到文件顶部" class="sidebar-link">2. import  命令的那一行代码不论写在哪里，都会提前到文件顶部</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_3-import-只读" class="sidebar-link">3. import 只读</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#_4" class="sidebar-link">4.</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#五、相同点" class="sidebar-link">五、相同点</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/engineering/design/modularity.html#六、额外说明" class="sidebar-link">六、额外说明</a></li></ul></li><li><a href="/knowledge-system/engineering/design/componential.html" class="sidebar-link">组件化</a></li><li><a href="/knowledge-system/engineering/design/design-pattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/knowledge-system/engineering/Vue/" class="sidebar-heading clickable"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/Vue/use.html" class="sidebar-link">使用</a></li><li><a href="/knowledge-system/engineering/Vue/principle.html" class="sidebar-link">原理</a></li><li><a href="/knowledge-system/engineering/Vue/Vue3.html" class="sidebar-link">Vue3</a></li><li><a href="/knowledge-system/engineering/Vue/how-about-Vue3.html" class="sidebar-link">how-about-Vue3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/React/set-interval.html" class="sidebar-link">functional component中的setInterval</a></li><li><a href="/knowledge-system/engineering/React/react-etc.html" class="sidebar-link">react相关技术栈</a></li></ul></section></li><li><a href="/knowledge-system/engineering/vdom/" class="sidebar-link">vdom</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/knowledge-system/engineering/webpack/" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h1> <h2 id="为什么要用模块"><a href="#为什么要用模块" class="header-anchor">#</a> 为什么要用模块</h2> <p>网站逐渐发展成网页应用程序 webApp，从 0 到 1 效率太低而且代码太长不好管理，有了模块，我们就可以更方便地使用别人的代码（复用性），想要什么功能，就加载什么模块（逻辑分离、按需加载），也提高了维护性。</p> <h2 id="发展"><a href="#发展" class="header-anchor">#</a> 发展</h2> <table><thead><tr><th>顺序</th> <th>规范名称</th> <th>特点</th> <th>实现的库</th> <th>关键用法</th></tr></thead> <tbody><tr><td>1</td> <td>CommonJs</td> <td>不能异步</td> <td></td> <td>exports、require</td></tr> <tr><td>2</td> <td>AMD</td> <td>实现了异步</td> <td>require.js</td> <td>define、require</td></tr> <tr><td>3</td> <td>ES6</td> <td>整合了</td> <td>原生语法</td> <td>export、import、import()</td></tr></tbody></table> <h1 id="webpack-中的-commonjs-和-es6-模块化"><a href="#webpack-中的-commonjs-和-es6-模块化" class="header-anchor">#</a> webpack 中的 CommonJs 和 Es6 模块化</h1> <p>弄懂 moudle.exports、require、export、import 关系和区别</p> <h2 id="一、moudle-exports、require"><a href="#一、moudle-exports、require" class="header-anchor">#</a> 一、moudle.exports、require</h2> <h3 id="_1-使用"><a href="#_1-使用" class="header-anchor">#</a> 1.  使用</h3> <ul><li>step1  写一个模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lily.js</span>

<span class="token keyword">let</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">getFamily</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> personInfo<span class="token punctuation">.</span>family<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  personInfo<span class="token punctuation">,</span>

  getFamily<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>step 2  使用这个模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>

<span class="token keyword">const</span> lily <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lily<span class="token punctuation">.</span><span class="token function">getFamily</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{mom: &quot;wang&quot;, dad: &quot;li&quot;}</span>
</code></pre></div><h3 id="_2-原理"><a href="#_2-原理" class="header-anchor">#</a> 2.  原理</h3> <blockquote><p>为什么写个文件通过  moudle.exports  导出，就是一个模块呢？</p></blockquote> <blockquote><p>为什么通过  require  就可以拿到这个模块呢？</p></blockquote> <ul><li>因为  webpack  对文件进行了处理，关键逻辑：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 准备一个模块的数据结构</span>

<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 把文件转换为模块的关键函数</span>

<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取文件的代码 =================</span>

  <span class="token comment">/* let personInfo = {

    name: &quot;lily&quot;,

    family: {

      mom: &quot;wang&quot;,

      dad: &quot;li&quot;,

    },

  }

  function getFamily() {

    return Object.values(person.family)

  }

  module.exports = {

    personInfo,

    getFamily,

  } */</span>

  <span class="token comment">// 读取文件结束 ====================</span>

  <span class="token comment">// moudle是load函数传过来的参数，我们在文件中写 moudle.exports = {xxx},{xxx}会作为load函数的返回值</span>

  <span class="token comment">// 所以如果要导出的部分必须得通过 moudle.exports , 这是个约定的写法</span>

  <span class="token comment">// 源码里面的逻辑不仅仅是读取代码，文件先转换为闭包，然后作用于绑定等等，比较复杂，这里就不上源码了</span>

  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行转换</span>

<span class="token keyword">var</span> exported <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 保存到模块统一处理的地方</span>

<span class="token function">save</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exported<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>当使用  require  的时候，会根据文件路径去保存模块的地方把对应的模块取出来</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
</code></pre></div><h3 id="_3-两种导出写法对比"><a href="#_3-两种导出写法对比" class="header-anchor">#</a> 3.两种导出写法对比</h3> <p>CommonJs  规范  module.exports={xxx} VS exports.xxx=xxx</p> <ul><li>exports.xxx=xxx  的写法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lily.js</span>

<span class="token keyword">let</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">getFamily</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> personInfo<span class="token punctuation">.</span>family<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>personInfo <span class="token operator">=</span> personInfo<span class="token punctuation">;</span> <span class="token comment">// 这样写也行： module.exports.person = person</span>
exports<span class="token punctuation">.</span>getFamily <span class="token operator">=</span> getFamily<span class="token punctuation">;</span> <span class="token comment">// 这样写也行：module.exports.getPerson = getPerson</span>
</code></pre></div><ul><li>其实  load  函数调用的时候其实不仅传了  moudle  还传了  module.exports</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>

  exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取文件的代码 ====================</span>

  <span class="token comment">// ...</span>

  <span class="token comment">// 这种写法不行: exports = {person:person,getPerson:getPerson},</span>

  <span class="token comment">// 因为传进来的exports是指向moudle.exports的，如果直接对exports赋值，那它和moudle的exports是没有任何关系了，而最后return的始终是module.exports，所以不能给exports直接赋值</span>

  <span class="token comment">// 读取文件结束 ========================</span>

  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> exported <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">save</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exported<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>防止多种用法写懵了，就统一用  module.exports={xxx}  吧</p></blockquote> <h2 id="二、es6-标准语法-export-和-import"><a href="#二、es6-标准语法-export-和-import" class="header-anchor">#</a> 二、ES6  标准语法  export  和  import</h2> <h3 id="_1-使用-2"><a href="#_1-使用-2" class="header-anchor">#</a> 1.  使用</h3> <ul><li>同样的内容，es6  写法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lily.js</span>

<span class="token keyword">let</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">getFamily</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> personInfo<span class="token punctuation">.</span>family<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> personInfo<span class="token punctuation">,</span> getFamily <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//main.js</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> personInfo<span class="token punctuation">,</span> getFamily <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>personInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-原理-2"><a href="#_2-原理-2" class="header-anchor">#</a> 2.  原理</h3> <ul><li>es6  的语法都会通过  babel  转换为  es5</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lily.js 转换后</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>getFamily <span class="token operator">=</span> exports<span class="token punctuation">.</span>personInfo <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>personInfo <span class="token operator">=</span> personInfo<span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">getFamily</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">getFamily</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> personInfo<span class="token punctuation">.</span>family<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>getFamily <span class="token operator">=</span> getFamily<span class="token punctuation">;</span>

<span class="token comment">// main.js 转换后</span>
<span class="token punctuation">(</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _lily <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_lily<span class="token punctuation">.</span>personInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>通过上面就可以看出，export xxx  最后其实还是转换成了  exports.xxx  的写法，需要注意的是  exports  有个__esModule  的属性值是  true。</p></li> <li><p>import  最后实际也是转换成了  require  去获取模块，并且是获取到整个模块，然后使用模块里面的值的时候，是   当前模块.属性   这种方式，并没有直接获取需要的属性。</p></li></ul> <h3 id="_3-export-default-xxxx、import-xxx-from、import-as-xxx-from"><a href="#_3-export-default-xxxx、import-xxx-from、import-as-xxx-from" class="header-anchor">#</a> 3. export default xxxx、import xxx from、import * as xxx from</h3> <ul><li><p>export {x1,x2}  和  import {x1,x2} from  是成对使用的，转换前后上面已经列出来了</p></li> <li><p>export default xxx  和  import xxx from  是成对使用的，转换前后如下</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//lily.js</span>

<span class="token keyword">let</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> personInfo<span class="token punctuation">;</span>

<span class="token comment">//main.js</span>

<span class="token keyword">import</span> person <span class="token keyword">from</span> <span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>import  后面接的变量名和模块文件中  export default  后面接的变量名不必一致，看如何转换就知道为什么可以不一样了</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//lily.js</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> personInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">,</span>

  family<span class="token operator">:</span> <span class="token punctuation">{</span>
    mom<span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span><span class="token punctuation">,</span>

    dad<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _default <span class="token operator">=</span> personInfo<span class="token punctuation">;</span>

<span class="token comment">// export default 导出的对象是挂在 exports的default属性下面的，并不是整个exports</span>

exports<span class="token punctuation">.</span>default <span class="token operator">=</span> _default<span class="token punctuation">;</span>

<span class="token comment">//main.js</span>
<span class="token punctuation">(</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _lily <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果是es6模块则直接返回这个对象，如果不是则返回一个新的对象，这个新的对象default属性就是指向这个对象</span>

<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_lily<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>可以看出来  export {xxx}  与  export default xxx  是不一样的，前者是  module.exports = {xxx}  后者是  module.exports.default=xxx ，所以  export default  和  export{xxx}  是可以共存的，并且  export default  只能有一个，多个的情况，后面的会覆盖前面的，使用的时候还是尽量不要混合两种用法。</p></li> <li><p>import xxx from，只要使用到  xxx  都是取模块.default  属性</p></li> <li><p>要想直接拿到整个模块就用  import * as xxx from，这种情况和  require()  拿到的结果是真正对应的</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lily.js</span>

<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;lily&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> info<span class="token punctuation">;</span>

<span class="token comment">// main.js</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> lilyModule <span class="token keyword">from</span> <span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lilyModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>转换比较复杂，不做展示</p></blockquote> <h2 id="三、commonjs和es6-混用"><a href="#三、commonjs和es6-混用" class="header-anchor">#</a> 三、CommonJS和ES6  混用</h2> <p>exports+require  和  export+import</p> <ul><li><p>因为  export、import  最后会转换成  exports+require，所以是可以混用的</p></li> <li><p>基于上一个  import *  的例子</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> lilyM1 <span class="token keyword">from</span> <span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lilyM2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./lily.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lilyM1 <span class="token operator">===</span> lilyM2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre></div><h2 id="四、两种规范-有什么区别"><a href="#四、两种规范-有什么区别" class="header-anchor">#</a> 四、两种规范，有什么区别？</h2> <h3 id="require-循环加载"><a href="#require-循环加载" class="header-anchor">#</a> require()  循环加载</h3> <blockquote><p>首先得知道模块之间有依赖的情况下是怎么加载的<br></p></blockquote> <p>require  第一次加载该脚本，就会执行整个脚本，然后在内存生成一个对象。以后需要用到这个模块的时候，就会到  exports  属性上面取值。即使再次执行  require  命令，也不会再次执行该模块，而是到缓存之中取值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//a.js</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//a1</span>
<span class="token keyword">const</span> bModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./b.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bModule<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a3</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//a4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a 执行完&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a5</span>
<span class="token comment">//b.js</span>
exports<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//b1</span>
<span class="token keyword">const</span> aModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b3</span>
exports<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//b4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;b 执行完&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b5</span>
<span class="token comment">//main.js</span>
aModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//m1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//m2</span>
bModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./b.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//m3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bModule<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//m4</span>
</code></pre></div><ul><li>运行过程:</li></ul> <p>m1-&gt;a1-&gt;a2-&gt; b1-&gt; b2(发生循环加载了，不去重复执行  a  了) -&gt; b3 (取  a  现有的状态，输出  false)-&gt; b4-&gt; b5(输出  “b  执行完”) -&gt; a3(输出  true) -&gt; a4-&gt; a5(输出  “a  执行完”) -&gt; m2( 取缓存中  a  的状态，输出  true) -&gt; m3(不去重复执行  b  了) -&gt; m4(取缓存中  b  的状态，输出  true)</p> <h3 id="_1-import-在编译时加载-require-在运行时加载"><a href="#_1-import-在编译时加载-require-在运行时加载" class="header-anchor">#</a> 1. import  在编译时加载，require  在运行时加载</h3> <ul><li><p>之所以这么说，因为  import  要先转换为  require，转换为  require  就是处于编译阶段</p></li> <li><p>真正运行在浏览器里面的是  require</p></li></ul> <h3 id="_2-import-命令的那一行代码不论写在哪里-都会提前到文件顶部"><a href="#_2-import-命令的那一行代码不论写在哪里-都会提前到文件顶部" class="header-anchor">#</a> 2. import  命令的那一行代码不论写在哪里，都会提前到文件顶部</h3> <ul><li>CommonJS 写法<br>
根据  require()  循环加载的原理，执行  a.js  后，运行步骤：a1-&gt;a2-&gt;b1-&gt;b2-&gt;b3  输出&quot;aaaa&quot;</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">&quot;aaaa&quot;</span><span class="token punctuation">;</span> <span class="token comment">//a1</span>
<span class="token keyword">const</span> bModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./b.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a2</span>
<span class="token comment">// b.js</span>
<span class="token keyword">const</span> aModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b1</span>
exports<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">&quot;bbbb&quot;</span><span class="token punctuation">;</span> <span class="token comment">//b2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;aModule.a in b.js&quot;</span><span class="token punctuation">,</span> aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b3</span>
</code></pre></div><ul><li>ES6 写法<br>
用  ES6  的写法，执行  a.js  后，a2-&gt;b1-&gt;b2-&gt;b3-&gt;a1  输出  undefined,这就是因为在  babel  转换的时候，import  会提到前面</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">&quot;aaaa&quot;</span><span class="token punctuation">;</span> <span class="token comment">//a1</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> b <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./b.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">//a2</span>
<span class="token comment">// b.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">;</span> <span class="token comment">//b1</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">&quot;bbbb&quot;</span><span class="token punctuation">;</span> <span class="token comment">//b2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a in b.js&quot;</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b3</span>
</code></pre></div><h3 id="_3-import-只读"><a href="#_3-import-只读" class="header-anchor">#</a> 3. import 只读</h3> <p>在转换的时候，发现  import  进来的值重新赋值，或者对  import  做条件判断，babel  就会报错,对  require  的结果重新赋值或者做条件判断是可以的  ，但是以下这种情况需要注意。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//a.js</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//main.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a指向a.js形成的模块</span>
a <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//a的指向发生改变，但是对本身a.js形成的模块没有影响</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//null</span>
consle<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[]</span>
</code></pre></div><h3 id="_4"><a href="#_4" class="header-anchor">#</a> 4.</h3> <p>当输出的是非引用类型时，ES6  写法可以响应模块内部对值的改变，CommonJS  不行。（当输出值是引用类型时两者情况一样）</p> <ul><li>非引用类型，CommonJS</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//这个时候的 a 和导出的 a 没有关系了，所以保存到模块里面的始终是当初那个 0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//main.js</span>

aModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>非引用类型，ES6</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 

Object.defineProperty(exports, &quot;__esModule&quot;, {

  value: true

});

exports.a = void 0;

var a = 0;

exports.a = a;

setTimeout(function () {

  exports.a = a = a + 1; //重新赋值的时候 永远带着 exports. 所以保存模块里面的那个值也变了

})

*/</span>

<span class="token comment">//main.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> aModule <span class="token keyword">from</span> <span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>引用类型，CommonJS</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//main.js</span>
aModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[]</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//[1]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>引用类型，ES6</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">export</span> a
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//main.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> aModule <span class="token keyword">from</span> <span class="token string">'./a.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token comment">//[]</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aModule<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token comment">//[1]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="五、相同点"><a href="#五、相同点" class="header-anchor">#</a> 五、相同点</h2> <p>import 最后会转换成 require 所以 import 命令也是同步的，非异步加载，为了满足异步加载的需求使用 import()</p> <h2 id="六、额外说明"><a href="#六、额外说明" class="header-anchor">#</a> 六、额外说明</h2> <p>import 语法命令是完全静态的（不能使用判断语句、不能使用变量），不会产生独立的 chunk。require 函数虽然可以动态加载（用 if else 语句控制动态加载、或者直接用变量控制动态加载）, 但是 require 并不会产生一个独立 chunk。import、require 的代码模块会合并到 entry 产生的 chunk 中。具体说明如下：</p> <h4 id="对-require-的解释"><a href="#对-require-的解释" class="header-anchor">#</a> 对 require 的解释</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// pages/demo/home/main.js</span>
<span class="token comment">// 根据客户端传参 params.skin 就是主题关键字</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../skin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>skin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>编译后的代码输出在一个 css 文件中。具体流程是：main.js 作为多页应用的一个入口，编译后形成一个 chunk,chunk 中包含了 main.js 引入的所有模块(所有以 import、require方式引入的模块)，样式代码编译后就在 这个 chunk(假设叫 entry-js-chunk) 中。然后，把 chunk 中的所有样式代码都抽离出来形成一个单独的 chunk(假设叫 css-chunk-from-js)。最后entry-js-chunk和css-chunk-from-js分别输入对应的js和css文件。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.demo-home-root</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #08ff70<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 5px solid #90ee90<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.demo-home-root:hover</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #e6941a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* ==========以上是绿色主题生成的代码======== */</span>
<span class="token comment">/* ==========以下是蓝色主题生成的代码======== */</span>
<span class="token selector">.demo-home-root</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #1a68c2<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 5px solid #87ceeb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.demo-home-root:hover</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #e3e61a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后两套样式都会合并到一个文件，弊端一，如果皮肤样式有很多套，并且根据需求每次只使用一套，请求文件的体积过大，且大部分属于没有用到的样式。弊端二，样式发生了覆盖，除了最后一份主题，其他的主题永远不会生效，并没有办法动态的加载某一套主题。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/knowledge-system/engineering/design/componential.html">
        组件化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.7767ddcb.js" defer></script><script src="/knowledge-system/assets/js/2.03bbdc7f.js" defer></script><script src="/knowledge-system/assets/js/64.68020544.js" defer></script>
  </body>
</html>
