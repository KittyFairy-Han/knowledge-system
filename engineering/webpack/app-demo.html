<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.4e160e22.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.5aa8b71f.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.3a6d1e24.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/16.7a6efd86.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.18e1b0f8.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.c9627050.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.81bb3719.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.b72fc67d.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.de926850.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.8c5bae6f.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.a11a9b0d.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.25d9901f.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.947d9474.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.40356726.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.e961372c.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.48787a09.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.f72a36c8.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.9f4c3e1b.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.c9cc237f.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.94fc376d.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.fbc32b10.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.b7d1360b.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.7d39140a.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.108f90b8.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.327abc59.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.6eacb1d7.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.5b2faa40.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.99ca6c10.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.aaa8e4c9.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.5626482e.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.66365f84.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.550378f3.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.dce5ec65.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.14fd2be1.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.acab44b2.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.20232087.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.4f4fcfe2.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.7bd8be5b.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.866632c0.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.32f41bc6.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.4630b0dd.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.baf51ebe.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.1e91e454.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.c2514873.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.2b0fed07.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.744b85f3.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.8c442987.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.c24dbeff.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.a3d38e55.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.2015517f.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.56cf6ce5.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.8f67eccd.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.285ffbb2.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.bd72e660.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.907078a6.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.7a7fcc50.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.e030a46b.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.47658269.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.d883936b.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.ad3d70dc.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.649a0eb4.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.7a5e14e2.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.698d3043.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.35aebddb.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.bf253007.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.fee9c878.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.1bfabd99.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.7deb4db6.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.c50ceb0c.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.656997c4.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.b68e07f6.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.6e413afb.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.864e29ba.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.e0998e83.js"><link rel="prefetch" href="/knowledge-system/assets/js/76.e0fc48b1.js"><link rel="prefetch" href="/knowledge-system/assets/js/77.0877efdc.js"><link rel="prefetch" href="/knowledge-system/assets/js/78.76f2692a.js"><link rel="prefetch" href="/knowledge-system/assets/js/79.d48961ea.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.88c42578.js"><link rel="prefetch" href="/knowledge-system/assets/js/80.faa0d185.js"><link rel="prefetch" href="/knowledge-system/assets/js/81.bd29afea.js"><link rel="prefetch" href="/knowledge-system/assets/js/82.f7632afa.js"><link rel="prefetch" href="/knowledge-system/assets/js/83.7220d618.js"><link rel="prefetch" href="/knowledge-system/assets/js/84.ee8af52a.js"><link rel="prefetch" href="/knowledge-system/assets/js/85.e67e9342.js"><link rel="prefetch" href="/knowledge-system/assets/js/86.7cd309d7.js"><link rel="prefetch" href="/knowledge-system/assets/js/87.474e4078.js"><link rel="prefetch" href="/knowledge-system/assets/js/88.05f028d8.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.300e54d0.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.4e160e22.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link router-link-active">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>模块化、组件化和设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/design/modularity.html" class="sidebar-link">模块化</a></li><li><a href="/knowledge-system/engineering/design/componential.html" class="sidebar-link">组件化</a></li><li><a href="/knowledge-system/engineering/design/design-pattern.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><a href="/knowledge-system/engineering/vdom/" class="sidebar-link">vdom</a></li><li><section class="sidebar-group depth-0"><a href="/knowledge-system/engineering/webpack/" class="sidebar-heading clickable router-link-active"><span>webpack</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge-system/engineering/webpack/main-flow.html" class="sidebar-link">主流程（主线剧情）</a></li><li><a href="/knowledge-system/engineering/webpack/chunk.html" class="sidebar-link">chunk</a></li><li><a href="/knowledge-system/engineering/webpack/optimization.html" class="sidebar-link">优化</a></li><li><a href="/knowledge-system/engineering/webpack/pluggable.html" class="sidebar-link">one-project-to-multiple-app</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="标题没想好"><a href="#标题没想好" class="header-anchor">#</a> 标题没想好</h1> <h2 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h2> <ol><li>插件化。<br>
工作中的一个项目称为 iarrm，遇到过一个插件化的需求，具体的业务场景是这样的:<br>
客户端有多个标签(可以理解为几个功能按钮的组合体)，标签类型有多种。每种类型的标签支持以插件的形式独立安装，安装后，客户端就携带这种插件的功能。点击一个标签中的一个按钮，根据当前标签的类型和点击的按钮，唤起对应的 web 页面, 相当于浏览器打开一个新的标签页。<br>
例如，安装了人脸插件的客户端，就携带有查看人脸抓拍历史、人脸实时抓拍情况、人脸数据统计图等功能。当点击人脸标签上的人脸历史按钮时，就打开人脸历史的 web 页面，使用其中的功能。</li></ol> <blockquote><p>标签的多种类型，从业务角度来讲，是对应多种不同的监控摄像头；从代码角度来讲，是对应多个 iarrm 插件。</p></blockquote> <p><img src="/knowledge-system/assets/img/app-demo-f1.92977ac8.png" alt="f1"></p> <ol start="2"><li><p>支持多主题。<br>
客户端唤起网页时，通知 web 当前使用的主题，web 全局应用该主题。
<img src="/knowledge-system/assets/img/app-demo-f2.5cc3e4af.png" alt="f2"></p></li> <li><p>提供一个脚手架<br>
要提供一个脚手架（公司内部前端工程都是 webpack+vue）给分公司，当新增标签类型时，尽量能够复用组件，只开发业务。</p></li></ol> <p>根据需求可以分析出来几个技术点：1 插件化 2 多主题 3 客户端与 web 通信 4 脚手架。下面就逐一击破吧~</p> <h2 id="插件化"><a href="#插件化" class="header-anchor">#</a> 插件化</h2> <p>“插件化” 这个概念映射到前端工程代码，该怎么理解呢？</p> <p>① 根据需求多个插件完全独立，就说明每个插件 ≈ 完整前端应用包</p> <blockquote><p>TIPS<br>
准确来讲每个插件对应前端应用包+后端应用包，但是我们这里不讨论后端。<br>
下文前端应用包或插件会使用 app 代指</p></blockquote> <p>这些插件对于前端开发来说，大多数的依赖和使用的组件都是相同的（比如上图的人脸、卡口插件都包含历史这个页面，页面上的具体功能都差不多)。
所以正确的方案应该是<strong>一个前端工程，可以输出多个不同的 app</strong>。这样更方便的实现组件的复用，也更方便项目的维护。</p> <p>② 根据需求，客户端标签中的每个按钮都会唤起一个 web 页面，所以每个 app 都包含多个 page，这是典型的 MPA。<br>
所以我们的<strong>每个 app 都是一个 MPA</strong> 即多页面应用。</p> <h2 id="与客户端通信"><a href="#与客户端通信" class="header-anchor">#</a> 与客户端通信</h2> <p>在这个项目中，通信这个功能，主要是客户端向 web 传达一些信息，web 是不需要主动调用客户端的功能的。所以只要弄明白 client 如何调用 js 就行了。<br>
其实 client-&gt;js 已经有了成熟的技术方案，前端需要做的就是在 window 上注册一个方法，client 调用这个方法进行一些信息的传达。<br>
每个页面功能不同，但都会传达的一个信息就是当前使用的主题，所以我们就以传递主题信息为例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// apps/demo/home/main.js</span>
window<span class="token punctuation">.</span><span class="token function-variable function">clientCallJs</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>skin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setSkin</span><span class="token punctuation">(</span>skin<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">setSkin</span><span class="token punctuation">(</span><span class="token parameter">skin</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 设置主题</span>
  <span class="token comment">// 下面小节将补充这个函数</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样，当客户端调用 clientCallJs 方法时，就会进入 js 内部的逻辑。我们根据 params 传参去做一些后续的事情。</p> <h2 id="多主题功能"><a href="#多主题功能" class="header-anchor">#</a> 多主题功能</h2> <h3 id="基本思路"><a href="#基本思路" class="header-anchor">#</a> 基本思路</h3> <p>结合这个项目的特点，多主题每次只会应用其中的一种，不需要在线换肤。所以采用的技术方案是，把多个主题分包，根据客户端传参去加载对应的文件，其他主题包不会用到，不需要去加载避免浪费资源。<br>
这里的关键点是分包，分包的方式有多种，<a href="https://juejin.cn/post/7004790532916379655" target="_blank" rel="noopener noreferrer">可以查看这篇文章：webpack chunk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。结合这个项目的需求，采用 import() 函数这种分包方式，达到拆分和异步加载的目的。
假设 demo 插件有两种色系的主题，蓝色和绿色。以demo-home页面为例子，源码目录大概就是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>project
  └── ....
      ├── demo
      |   ├── home
      |   |   ├──main.js
      |   |   ├──themes
      |   |   |   ├──blue.less      //home页面蓝色主题样式定义在这里
      |   |   |   └──green.less     //home页面蓝色主题样式定义在这里
      |   |   └──App.vue
      |   └── ...
      └── ....
</code></pre></div><p>引入皮肤的代码雏形大概就是这样的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// apps/demo/home/main.js</span>
<span class="token keyword">function</span> <span class="token function">setSkin</span><span class="token punctuation">(</span><span class="token parameter">skin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* webpackChunkName: &quot;themes-&quot; */</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了后面更加方便的介绍。我把 App.vue、blue.less、green.less 的代码贴一下</p> <div class="language-vue extra-class"><pre class="language-vue"><code>
</code></pre></div><h3 id="目录结构以及使用示例"><a href="#目录结构以及使用示例" class="header-anchor">#</a> 目录结构以及使用示例</h3> <div class="language-code extra-class"><pre class="language-text"><code>  src
  ├── main.js
  ├── ...
  ├── skin
  |   ├── green
  |   |   ├── theme.less # 定义一些主题通用的变量
  |   |   ├── demo-vars.less # 定义一些业务相关的变量
  |   |   └── index.less # green 主题的主人口 里面引用了green/theme.less、green/demo-vars.less、style/demo.less
  |   ├── blue
  |   |   ├── theme.less # 定义一些主题通用的变量
  |   |   ├── demo-vars.less # 定义一些业务相关的变量
  |   |   └── index.less # blue 主题的主人口 blue/theme.blue/demo-vars.less、style/demo.less
  |   └── style
  |       └── demo.less # demo 使用对应的业务变量或者直接引用主题变量定义样式
  └── ...

</code></pre></div><ul><li>green</li></ul> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">// green/theme.less</span>
<span class="token variable">@main-color<span class="token punctuation">:</span></span> #08ff70<span class="token punctuation">;</span>
<span class="token variable">@main-act-color<span class="token punctuation">:</span></span> #e6941a<span class="token punctuation">;</span>
<span class="token variable">@text-color<span class="token punctuation">:</span></span> white<span class="token punctuation">;</span>
<span class="token comment">//green/demo-vars.less</span>
<span class="token variable">@demo-home-border-color<span class="token punctuation">:</span></span> lightgreen<span class="token punctuation">;</span>
<span class="token comment">// green/index.less 顺序必须是先引入变量文件然后引入业务代码</span>
<span class="token variable">@import</span> <span class="token string">&quot;./theme.less&quot;</span><span class="token punctuation">;</span>
<span class="token variable">@import</span> <span class="token string">&quot;./demo-vars.less&quot;</span><span class="token punctuation">;</span>
<span class="token variable">@import</span> <span class="token string">&quot;../style/demo.less&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>blue</li></ul> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">//blue/theme.less</span>
<span class="token variable">@main-color<span class="token punctuation">:</span></span> #1a68c2<span class="token punctuation">;</span>
<span class="token variable">@main-act-color<span class="token punctuation">:</span></span> #e3e61a<span class="token punctuation">;</span>
<span class="token variable">@text-color<span class="token punctuation">:</span></span> white<span class="token punctuation">;</span>
<span class="token comment">//blue/demo-vars.less</span>
<span class="token variable">@demo-home-border-color<span class="token punctuation">:</span></span> skyblue<span class="token punctuation">;</span>
<span class="token comment">//blue/index.less 顺序必须是先引入变量文件然后引入业务代码</span>
<span class="token variable">@import</span> <span class="token string">&quot;./theme.less&quot;</span><span class="token punctuation">;</span>
<span class="token variable">@import</span> <span class="token string">&quot;./demo-vars.less&quot;</span><span class="token punctuation">;</span>
<span class="token variable">@import</span> <span class="token string">&quot;../style/demo.less&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>style</li></ul> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">//style/demo.less</span>
<span class="token selector">.demo-home-root</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token variable">@main-color</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 5px solid <span class="token variable">@demo-home-border-color</span><span class="token punctuation">;</span>
  <span class="token selector">&amp;:hover</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token variable">@main-act-color</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="how-to-分-chunk"><a href="#how-to-分-chunk" class="header-anchor">#</a> how to 分 chunk</h3> <p>引入 模块的几种方式 import、require、import()。这几种方式只有 import() 能实现自动划分 chunk，如果使用 import 或者 require 需要手动配置 splitChunk，所以采用了 import() 的方式。如果想要了解配置 splitChunk 主动划分移步 chunk 章节。</p> <blockquote><p>(webpack 官方提示：可以自己配置分包，但是不要在没有实践测量的情况下，尝试手动优化这些参数。默认模式是经过千挑万选的，可以用于满足最佳 web 性能的策略。)</p></blockquote> <h4 id="写法"><a href="#写法" class="header-anchor">#</a> 写法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// apps/demo/home/main.js</span>
<span class="token keyword">function</span> <span class="token function">setSkin</span><span class="token punctuation">(</span><span class="token parameter">skin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* webpackChunkName: &quot;global-themes-&quot; */</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./themes/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用魔法注释为chunk命名,这样打包出来的文件名就是global-themes0、global-themes1、...</span>
</code></pre></div><h4 id="打包后两个主题文件分别为-global-themes0-css-绿色主题对应的-css-、global-themes1-css-蓝色主题对应的-css"><a href="#打包后两个主题文件分别为-global-themes0-css-绿色主题对应的-css-、global-themes1-css-蓝色主题对应的-css" class="header-anchor">#</a> 打包后两个主题文件分别为 global-themes0.css(绿色主题对应的 css)、global-themes1.css (蓝色主题对应的 css)</h4> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* global-themes0.css 绿色主题对应的css */</span>
<span class="token selector">.demo-home-root</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #08ff70<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 5px solid #90ee90<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.demo-home-root:hover</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #e6941a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* global-themes1.css 蓝色主题对应的css */</span>
<span class="token selector">.demo-home-root</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #1a68c2<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 5px solid #87ceeb<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.demo-home-root:hover</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #e3e61a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id=""><a href="#" class="header-anchor">#</a></h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// vue.config.js -- 在生产环境下 ===== start</span>
<span class="token comment">// 当前的 process.env.PLUGIN_KEY值是 demo</span>
<span class="token comment">// 读取 src/pages/demo 下面的的所有目录，也就是 home、about</span>
<span class="token keyword">const</span> pageNameList <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PLUGIN_KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置当前plugin所有page下面的main.js为入口，也就是 home、about 目录下的 main.js 为两个入口</span>
pageNameList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pageName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  pages<span class="token punctuation">[</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/main.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最后形成的多页面配置项是这样的</span>
<span class="token comment">// pages:{</span>
<span class="token comment">//   &quot;demo-home&quot;:&quot;src/pages/demo/home/main.js&quot;,</span>
<span class="token comment">//   &quot;demo-about&quot;:&quot;src/pages/demo/about/main.js&quot;</span>
<span class="token comment">// }</span>
<span class="token comment">// vue.config.js -- 在生产环境下 ===== end</span>
<span class="token comment">// vue.config.js -- 在开发环境下 ===== start</span>
<span class="token keyword">const</span> pluginKeyList <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/pages</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pluginKeyList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pluginKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pageNameList <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  pageNameList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pageName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">[</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pluginKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/main.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">//根据pluginKey去配置pages选项</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// vue.config.js -- 在开发环境下 ===== end</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>pages <span class="token operator">=</span> pages<span class="token punctuation">;</span>
</code></pre></div><p>process.env.PLUGIN_KEY 拿到命令行中 PLUGIN_KEY=xxx 的 xxx。然后根据 process.env.PLUGIN_KEY 去 pages 对应的目录下找 main.js,配置 vue.config.js 中的 pages 选项。在开发环境下，是没有 process.env.PLUGIN_KEY 的，那么就是把 pages 下所有目录中的 main.js 都找到配置 vue.config.js 中的 pages 选项。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.5aa8b71f.js" defer></script><script src="/knowledge-system/assets/js/2.3a6d1e24.js" defer></script><script src="/knowledge-system/assets/js/16.7a6efd86.js" defer></script>
  </body>
</html>
