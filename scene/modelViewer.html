<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.c0d58452.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.5febedce.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.ac8d6607.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/23.332db5fe.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.73091b0e.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.bd125928.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.dfa63448.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.0e60e21a.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.94077bbe.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.5f95f3e7.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.14033455.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.6ed3571d.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.41d44ee6.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.fbcec3fa.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.ba1b499d.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.2be1f9f9.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.483951d7.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.777bb3cc.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.e60ed5ec.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.4a3b438e.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.28abbe41.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.6ffe9327.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.669bdfdf.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.ddf4f22c.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.cf92ee57.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.fcf6e0e6.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.e73e3a04.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.58f89d7c.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.f8073982.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.04c0195f.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.fa83f57d.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.e983472d.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.692fb86f.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.968f9960.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.c13deac6.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.0450050a.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.b0879504.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.0b04343c.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.0a55d67b.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.3b9abf37.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.2d5d4e3e.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.c9420e00.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.9dfb8456.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.68f7446a.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.d1c597ff.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.4f84f4fc.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.2b960af4.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.382f0ae6.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.c2ea0596.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.114f83af.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.5bbdd30c.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.396179dd.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.fbe28e1e.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.be8035be.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.360ab674.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.860cca20.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.224a96a1.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.96dae9ee.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.1f5ce7a8.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.140bbc10.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.4075385a.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.ec7361e8.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.f11e1ec7.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.26685405.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.fc7311ce.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.bc201e73.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.1f970eef.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.75716b14.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.e4572ffe.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.2021abfd.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.2cc0b6e9.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.69bb8b4a.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.c0b54b2e.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.c78652de.js"><link rel="prefetch" href="/knowledge-system/assets/js/76.e2153b75.js"><link rel="prefetch" href="/knowledge-system/assets/js/77.356d090c.js"><link rel="prefetch" href="/knowledge-system/assets/js/78.8ab7918f.js"><link rel="prefetch" href="/knowledge-system/assets/js/79.b26df0e4.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.94d74581.js"><link rel="prefetch" href="/knowledge-system/assets/js/80.eba81724.js"><link rel="prefetch" href="/knowledge-system/assets/js/81.63048eed.js"><link rel="prefetch" href="/knowledge-system/assets/js/82.e2cf7548.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.cd26c454.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.c0d58452.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/knowledge-system/scene/lottieUsage.html" class="sidebar-link">lottie的应用场景</a></li><li><a href="/knowledge-system/scene/screenshoots.html" class="sidebar-link">前端截屏方案</a></li><li><a href="/knowledge-system/scene/modelViewer.html" aria-current="page" class="active sidebar-link">modelViewer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#_3d-渲染相关的基础概念" class="sidebar-link">3d 渲染相关的基础概念</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#model-viewer-核心概念" class="sidebar-link">model-viewer 核心概念</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#model-viewer-基本使用" class="sidebar-link">model-viewer 基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#控制相机" class="sidebar-link">控制相机</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#环境光" class="sidebar-link">环境光</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#动画-针对内置了动画的模型" class="sidebar-link">动画(针对内置了动画的模型)</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#模型变换" class="sidebar-link">模型变换</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#材质和纹理" class="sidebar-link">材质和纹理</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#导出模型" class="sidebar-link">导出模型</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#使用经验分享" class="sidebar-link">使用经验分享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#内容替换" class="sidebar-link">内容替换</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#白底优化" class="sidebar-link">白底优化</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/scene/modelViewer.html#一些其他避坑指南" class="sidebar-link">一些其他避坑指南</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_3d-渲染相关的基础概念"><a href="#_3d-渲染相关的基础概念" class="header-anchor">#</a> 3d 渲染相关的基础概念</h2> <p>如果不了解材质、纹理这些基本概念，下面的材质纹理部分可能会比较懵。在这里简单介绍一下：</p> <ul><li>材质(Material):是表现光照效果的一个数据集</li> <li>纹理(Texture):应用到物体上的样式</li> <li>着色器(Shader):本质上是程序代码，根据光照、材质来计算最后映射到每个像素的颜色,这个颜色来源于纹理。可以把材质和纹理都理解为着色器要用的一个素材。</li> <li>变体(Variant):很多时候，效果不同，但 shader 代码差异较小。这个时候 shader 就会有多个分身，变体就可以理解为分身。</li></ul> <h2 id="model-viewer-核心概念"><a href="#model-viewer-核心概念" class="header-anchor">#</a> model-viewer 核心概念</h2> <p>model-viewer 的能力大致分为：<strong>控制相机、设置环境与光线、控制模型动画、设置材质纹理、XR(AR+VR)、导出模型</strong>这几个大部分。<br>
model-viewer 对外的几个核心概念：</p> <ul><li><p><strong>attributes</strong>, 是指 html 标签内联的属性,可读写,例如 auto-rotate。(下面的例子可以区分 attributes 与 properties)</p></li> <li><p><strong>properties</strong>, 字面意思看也是属性,不能通过内联形式去设置,只能读取例如 turntableRotation ：</p></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model-viewer</span> <span class="token attr-name">auto-rotate</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-ar-mv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>model-viewer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> modelViewer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;my-ar-mv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//modelViewer.autoRotate = true 为 attribute 写入的另一种方式</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modelViewer<span class="token punctuation">.</span>autoRotate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//attribute 读取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modelViewer<span class="token punctuation">.</span>turntableRotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//开启自动旋转后,可以通过这个property,获取模型自转的角度(逆时针)</span>
</code></pre></div><blockquote><p>下文的 modelViewer 都是指 model-viewer 对应的 node 节点</p></blockquote> <ul><li><strong>methods</strong>, 方法有通过 modelViewer 调用的,也有通过 modelViewer.model 调用的,或更深层的属性比如材质去调用的。</li> <li><strong>events</strong>, 监听事件 绑定在 modelViewer 上。</li> <li><strong>slots</strong>, 通常用在跟随模型的可交互的标记点。</li></ul> <h2 id="model-viewer-基本使用"><a href="#model-viewer-基本使用" class="header-anchor">#</a> model-viewer 基本使用</h2> <p>model-viewer 的文档对新手来说可读性和引导性一般,在做项目的时候去查文档效率比较低,有时会因为实现一个效果反复的试错。所以我才会写这一 Part。</p> <h3 id="控制相机"><a href="#控制相机" class="header-anchor">#</a> 控制相机</h3> <ul><li>camera-controls 开启用户交互：旋转和缩放</li> <li>enable-pan 开启交互：位移</li> <li>disable-zoom 关闭缩放的交互</li> <li>custom-prompt 自定义操作</li></ul> <p>自动旋转与交互手势旋转可以同时用</p> <ul><li>auto-rotate 自动旋转</li> <li>auto-rotate-delay 自动旋转</li> <li>camera-orbit 设置 0~3.5m 生效,大于 3.5m 不生效</li></ul> <h3 id="环境光"><a href="#环境光" class="header-anchor">#</a> 环境光</h3> <ul><li>skybox-image 应用背景并模拟出环境光</li> <li>environment-image 环境光但不应用于背景,通过配置一个图片去计算出环境光,不设置也有一个默认的环境光,另外有个内置的值 neutral,
可以同时使用
环境图像应该不超过 1k (1024x512),因为它们在内部被固定到这个分辨率。</li> <li>exposure 曝光度
这些表现和模型表面的粗糙度有关系可以查看<a href="https://modelviewer.dev/examples/lightingandenv/#anotherHDRExample" target="_blank" rel="noopener noreferrer">这个例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="动画-针对内置了动画的模型"><a href="#动画-针对内置了动画的模型" class="header-anchor">#</a> 动画(针对内置了动画的模型)</h3> <ul><li>animationName 通过动画名称控制模型现在播放的动画,播放的同时改变动画时,它们会交叉淡出</li> <li>autoplay 自动播放所有的动画,顺序就按内置的来</li> <li>animation-crossfade-duration 交叉变换的时间</li> <li>modelViewer.play() 函数主动触发播放函数
animationName 配合 autoplay 或者 modelViewer.play()使用时才会播放动画,否则动画处于暂停状态,会显示第一帧</li></ul> <h3 id="模型变换"><a href="#模型变换" class="header-anchor">#</a> 模型变换</h3> <blockquote><p>模型变换和相机变换不一样</p></blockquote> <ul><li>availableVariants 只读属性,读取模型变体</li> <li>variantName 变体名称</li> <li>orientation 模型旋转</li> <li>scale 模型缩放</li> <li>updateFraming() 模型加载后改变 orientation 和 scale 需要调用这个方法,才生效。</li></ul> <h3 id="材质和纹理"><a href="#材质和纹理" class="header-anchor">#</a> 材质和纹理</h3> <ul><li>modelviewer.model.getMaterialByName() - 获取材质常用方法</li> <li>modelviewer.createTexture() -创建纹理</li> <li>material[xxx].setMetallicFactor() - 设置材质的金属程度</li> <li>material[xxx].setRoughnessFactor() - 设置材质的粗糙程度</li></ul> <h3 id="导出模型"><a href="#导出模型" class="header-anchor">#</a> 导出模型</h3> <p>主要依赖这个方法：</p> <ul><li>exportScene()
<a href="https://modelviewer.dev/examples/scenegraph/#pickMaterialExample" target="_blank" rel="noopener noreferrer">例子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="使用经验分享"><a href="#使用经验分享" class="header-anchor">#</a> 使用经验分享</h2> <p>上面对 model-viewer 已经有了基础的认知，下面介绍一下我在工作中的一些使用经验。</p> <h3 id="内容替换"><a href="#内容替换" class="header-anchor">#</a> 内容替换</h3> <h4 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h4> <p>需要实现的需求大概是：展示一个 3d 旋转的相框，相框是固定的，相框上的相片是动态数据。</p> <h4 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h4> <p>有了上面对模型材质、纹理概念的了解，就很容易想到把相片作为 texture，根据动态的数据去替换 material 上的 texture 即可。不就是</p> <ol><li>创建纹理 const t = modelViewer.createTexture('xxx.jpg')</li> <li>找到对应的材质，然后设置纹理 material[channel].setTexture(t)
嘛~好简单呐~但真的实践起来就会发现纸上谈兵真容易哈哈哈...</li></ol> <h4 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h4> <p>(均为思路讲解代码，无法直接使用)</p> <ul><li>迈坑一<br>
这里有个比较麻烦的点就是不知道 setTexture 要用谁去调用，那要怎么确定呢？<br>
方案 ① 提供模型的人要给出一个具体的材质名，和具体的属性路径，如材质名是 Center，属性路径为.pbrMetallicRoughness.baseColorTexture。<br>
方案 ② 和提供模型的人商量一个标志位，让 ta 把要替换的纹理名称作为标志，开发时去 json 文件里去找到这个标志位，属性路径也就一目了然了。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model-viewer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xxx.gltf<span class="token punctuation">&quot;</span></span> <span class="token attr-name">auto-rotate</span> <span class="token attr-name">camera-controls</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>model-viewer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> targetMaterial <span class="token operator">=</span> modelViewer<span class="token punctuation">.</span>model<span class="token punctuation">.</span>materials<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">material</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> material<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//找到材质</span>
<span class="token keyword">const</span> targetTexture <span class="token operator">=</span> <span class="token keyword">await</span> modelViewer<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token string">&quot;xxx.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用图片创建纹理</span>
targetMaterial<span class="token punctuation">.</span>pbrMetallicRoughness<span class="token punctuation">.</span>baseColorTexture<span class="token punctuation">.</span><span class="token function">setTexture</span><span class="token punctuation">(</span>targetTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>迈坑二:需要注意的是，要在 modelViewer loaded 之后再去进行上面的步骤，加个事件监听的逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code>modelViewer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//上面的替换逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>迈坑三:如果要替换的位置本身就有了纹理图片，我们的替换操作可能失败。原因不确定，通过现象推断应该是个 bug，模型已有的纹理图片和我们设置的纹理图片哪个加载的慢，哪个就是最终展示出来的纹理。我当时采用的方法是，让提供模型的人不要设置默认的纹理图片，只设置颜色。曲线解决了问题。</p> <p>终于可以愉快的实现这个功能辣~<a href="https://codesandbox.io/s/cranky-mopsa-qg5jhr?file=/index.html" target="_blank" rel="noopener noreferrer">这是一个完整示例-1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="白底优化"><a href="#白底优化" class="header-anchor">#</a> 白底优化</h3> <h4 id="发现问题"><a href="#发现问题" class="header-anchor">#</a> 发现问题</h4> <p>发现模型加载的过程中有白底，这种体验不太好，当页面的背景不是白色的时候会很违和。</p> <h4 id="解决思路"><a href="#解决思路" class="header-anchor">#</a> 解决思路</h4> <p>可能很多人第一反应和我一样就是给 model-viewer 背景颜色设置成透明的，设置了之后发现模型加载结束后这个背景颜色是生效的，但是加载过程中还是白的。（体验一下上面的例子就可以发现）<br>
有了上面对基本使用的了解，就可以马上联想到既然是加载过程中的，那应该和 poster 这个 attr 有关。官方<a href="https://modelviewer.dev/examples/loading/#displayPoster" target="_blank" rel="noopener noreferrer">在这个 example 中<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>确实提到了，看起来就是</p> <ol><li>配置 model-viewer 的 poster 属性</li> <li>css 里面写上 model-viewer{--poster-color: transparent;} 就行了。</li></ol> <p>这次没有坑了~顺顺利利设置成功~<a href="https://codesandbox.io/s/cranky-mopsa-qg5jhr?file=/poster-color.html" target="_blank" rel="noopener noreferrer">基于上面的完整示例-1 改进版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>可能比官方例子看起来更明显一些。</p> <h4 id="原因"><a href="#原因" class="header-anchor">#</a> 原因</h4> <p>model-viewer 在模型加载之前会有一个海报占位区域,本质上是一个 background-color 为白色的 button。<br> <img src="/knowledge-system/assets/img/model-viewer_poster.7ad93e87.png" alt="dom结构"><br>
配置了 poster 后,这个 button 的 background-image 就是 poster。如果 poster 有透明的部分, 那么白色的 background-color 还是会露出来。所以要从根本解决问题不仅要配置 poster 还得把 background-color 改为透明的。<br>
设置 background-color 就用上面的 css 变量方法，其实 poster 的配置也可以通过 css 变量的方式，可以查看<a href="https://codesandbox.io/s/cranky-mopsa-qg5jhr?file=/poster-color.html" target="_blank" rel="noopener noreferrer">完整示例-1 改进版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中 css 部分被注释的代码。</p> <h4 id="继续思考"><a href="#继续思考" class="header-anchor">#</a> 继续思考</h4> <ul><li>一问：这中方式行不行呢？</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">model-viewer #default-poster</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>二问：答案肯定是不行辣，为啥妮？<br>
因为 model-viewer 基于 web components 实现的,web components 的 shadowRoot 里面元素的样式通过外部是无法修改的,选择器选不到内部元素。</li></ul> <blockquote><p>MDN 上的解释：Web Components 是一套不同的技术,允许您创建可重用的定制元素（它们的功能封装在您的代码之外）并且在您的 web 应用中使用它们。简而言之就是自定义的 html 标签。</p></blockquote> <ul><li>三问：怎么修改 shadowRoot 内部的样式？
通过插 style 标签到 shadowRoot 内部去设置样式。如：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> styleStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
#default-poster {
  background-color: transparent;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-image: none;
  height: 102%;
}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> styleTag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
styleTag<span class="token punctuation">.</span>textContent <span class="token operator">=</span> styleStr<span class="token punctuation">;</span>
<span class="token keyword">const</span> shadow <span class="token operator">=</span> modelViewer<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">;</span>
shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>styleTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="一些其他避坑指南"><a href="#一些其他避坑指南" class="header-anchor">#</a> 一些其他避坑指南</h3> <ul><li>不启用某个属性,就不写这个属性,拿位移举个例子位移。</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// 特别要注意的是这种写法还是会启动这个属性</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model-viewer</span> <span class="token attr-name">enable-pan</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">// 正确写法</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model-viewer</span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ul><li>onload事件
模型的加载不是 model-viewer 这个 dom 节点的 onload 事件,模型加载完成是一定晚于 onload 事件的。<br>
我们上面用的 onload 事件都是 dom 节点上的。<br>
model-viewer没有提供模型加载的钩子,所以业务页面无法监听到模型加载完成事件。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/knowledge-system/scene/screenshoots.html" class="prev">
        前端截屏方案
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.5febedce.js" defer></script><script src="/knowledge-system/assets/js/2.ac8d6607.js" defer></script><script src="/knowledge-system/assets/js/23.332db5fe.js" defer></script>
  </body>
</html>
