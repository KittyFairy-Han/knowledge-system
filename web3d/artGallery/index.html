<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>带你入门 web3d 开发</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.c0d58452.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.9a1ee131.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.23e8f8fa.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/3.071290b9.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.d297245e.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.28070aae.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.8d7112dc.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.e4263515.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.79be9d0e.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.3b0283b0.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.2c542ec0.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.eca408d8.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.d76e974d.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.49c6ca6a.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.2f362b67.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.891d9b6a.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.f17721f1.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.6717cde1.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.7e6c3ff5.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.a0377bc6.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.fc00b2c2.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.9b3b1d47.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.40b4b82c.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.390cfb03.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.a32c7810.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.667e8bf9.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.fc455274.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.91ef3a1e.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.82e3466a.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.921aa028.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.e26e1512.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.2ebc6660.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.5d827910.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.95dab843.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.bdb6f232.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.7b2ac9c1.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.5861da4a.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.4ba289ee.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.c37dbe8c.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.35f2a616.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.5a0297ea.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.0f2cde54.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.0648d7e4.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.4abb3504.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.d748d684.js"><link rel="prefetch" href="/knowledge-system/assets/js/5.4343c4fc.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.3b89cfa0.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.3efb5851.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.bb2d0cff.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.028c9a4c.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.2febd880.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.be532779.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.fef5ba63.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.17628ac8.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.a0275943.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.5c7852a5.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.0bde10b4.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.b3e708b4.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.36d25471.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.930509d3.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.99605edf.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.0be91e9e.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.e11a7f45.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.b9059598.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.1ff13b3b.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.22182db2.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.5b6bae3f.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.793cfd75.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.4c229c2f.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.d8964086.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.fe90d86d.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.67042879.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.1bc92ed7.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.11f7b7f7.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.62102bae.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.ac36915c.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.c0d58452.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link router-link-active">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link router-link-active">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/knowledge-system/web3d/artGallery/" aria-current="page" class="active sidebar-link">3d入门之空间与模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#three-api" class="sidebar-link">three api</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#功能与技术点介绍" class="sidebar-link">功能与技术点介绍</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#模型显示" class="sidebar-link">模型显示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#空间关系" class="sidebar-link">空间关系</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#实际工作中的-tips" class="sidebar-link">实际工作中的 tips</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#动态数据与模型融合-画作处理" class="sidebar-link">动态数据与模型融合：画作处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#图片数据与模型的融合方案" class="sidebar-link">图片数据与模型的融合方案</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#更多思考" class="sidebar-link">更多思考</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/artGallery/#交互" class="sidebar-link">交互</a></li></ul></li><li><a href="/knowledge-system/web3d/agInteraction/" class="sidebar-link">3d入门之交互</a></li><li><a href="/knowledge-system/web3d/performanceOptimization/" class="sidebar-link">web3d性能优化</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="带你入门-web3d-开发"><a href="#带你入门-web3d-开发" class="header-anchor">#</a> 带你入门 web3d 开发</h1> <p>真实案例欢迎扫码体验：<br> <img src="/knowledge-system/assets/img/ch0-1.d332391f.png" alt="扫码体验一下"><br>
里面主要就涉及模型显示、数据与模型结合、场景交互三部分内容。本文也是从这三个点出发，举简单的例子带大家入入门。</p> <h2 id="three-api"><a href="#three-api" class="header-anchor">#</a> three api</h2> <p>首先还是要先介绍一下 three 基础的 api （概念、功能模块）</p> <ul><li>帧的概念<br>
three 里面必写的逻辑</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//每帧渲染</span>
    <span class="token comment">//...</span>
    <span class="token comment">//每帧渲染</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>loader<br>
用来加载外部资源：纹理图片、3d 模型等。如 GLTFLoader 用来加载 gltf、glb 等模型文件；TextureLoader 用来加载纹理图片。</li> <li>canvas 元素
就是那个 canvas（(＾＿－)</li> <li>render<br>
把 3d 空间在相机中的画面渲染到 canvas</li> <li>scene<br>
3D 场景根对象，所有物体都会在 scene 对象下</li> <li>Object 3D （包括相机）<br>
最基础的属性：position、rotation 。物体 3d 变换可以通过设置如上两个属性进行，比如相机的运镜效果就是通过改变相机的 position 和 rotation 来实现的。</li> <li>相机<br>
3d 空间最常用的是透视相机，下文所述“相机”都是指透视相机</li></ul> <h4 id="基础示-🌰"><a href="#基础示-🌰" class="header-anchor">#</a> 基础示 🌰</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">App3dScene</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app-canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> App3dScene<span class="token punctuation">.</span><span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> App3dScene<span class="token punctuation">.</span><span class="token function">createScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> App3dScene<span class="token punctuation">.</span><span class="token function">createCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onWindowResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">createScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">createCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span>
      <span class="token number">70</span><span class="token punctuation">,</span>
      window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
      <span class="token number">0.01</span><span class="token punctuation">,</span>
      <span class="token number">10000</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> camera<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      antialias<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      alpha<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      canvas<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> renderer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//   console.log('update')</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>req <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">onWindowResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="功能与技术点介绍"><a href="#功能与技术点介绍" class="header-anchor">#</a> 功能与技术点介绍</h2> <p>真实案例的细节和功能比较多，下文讲解是从技术点出发，不涉及业务。</p> <ul><li>模型显示：采用“面片系统”(几何结构+烘焙贴图)的方案搭建场景。代码上和加载 3d 模型一样，区别在于模型资源内部不同。这种方式其实主要是 web 上的性能优化。</li> <li>动态数据与模型融合：动态数据指用户上传的图片，画框是模型中的一部分。上传后两者要相互适应，图片数据融合进模型。</li> <li>交互系统：单指滑动浏览，点击与画框交互。</li></ul> <p><a href="https://codesandbox.io/p/sandbox/pedantic-pascal-06ugc1" target="_blank" rel="noopener noreferrer">技术点集合写了个完整的 demo，源码点这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,扫码可体验（国外网站，稍安勿躁）：<br> <img src="/knowledge-system/assets/img/ch0-2.43f1e8c6.png" alt="demo预览二维码"></p> <h2 id="模型显示"><a href="#模型显示" class="header-anchor">#</a> 模型显示</h2> <p>对于刚入门 3D 开发的人来说，可能经常遇到一个问题，就是明明把物体或模型加到场景中了，但是没显示出来。所有的原因都可以归结于空间关系不对。所以下面我们先来说说空间关系。</p> <h3 id="空间关系"><a href="#空间关系" class="header-anchor">#</a> 空间关系</h3> <p>物体在相机的视野范围内（图中灰色的四棱台空间）才能看到物体。反应到代码中相机的位置、物体的位置、相机空间的大小、模型大小就很重要。
<img src="/knowledge-system/assets/img/space_camera.aa6d743c.jpg" alt="相机空间示意图">
下文中的相机传参与图片对应</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">static</span> <span class="token function">createCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span>
      <span class="token number">90</span><span class="token punctuation">,</span><span class="token comment">//fov</span>
      window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span><span class="token comment">//width/height</span>
      <span class="token number">0.01</span><span class="token punctuation">,</span><span class="token comment">//near</span>
      <span class="token number">10000</span><span class="token comment">//far</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> camera<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>回顾我们案例，相机是在房间模型里面的。我们先举个最最基础的例子，让相机位于一个正方体中间。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createCube</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cubeGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cubeGeometry<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//图贴到里面</span>
  <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> f <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://res5.xingtuyunlian.com/1651199904993468893</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cubeMaterial <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//right</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//left</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//top</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">&quot;green&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//bottom</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//front</span>
    <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> map<span class="token operator">:</span> f<span class="token punctuation">,</span> transparent<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//back 背面为图片，其他面都是颜色</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>cubeGeometry<span class="token punctuation">,</span> cubeMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> cube<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">App3dScene</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> App3dScene<span class="token punctuation">.</span><span class="token function">createCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//相机放在原点</span>
    <span class="token keyword">const</span> cube <span class="token operator">=</span> <span class="token function">createCube</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建边长为5,各个面颜色不同的正方体</span>
    cube<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//正方体也放在原点偏下的位置</span>
    <span class="token comment">// 实现相机正好在物体的正中央</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ....</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>大概效果就是：<br> <img src="/knowledge-system/assets/img/ch3.2337123a.gif" alt="大概就是这个效果啦"></p> <blockquote><p>相机默认是朝向 z 轴负方向的！也就是说相机和其他物体（正方向都是+z）不一样。</p></blockquote> <p>模型能否正常显示其实和正方体是一样的，也是需要注意模型与相机的空间位置关系。因模型资源不能直接对外使用，所以不直接用模型举例啦，列一下模型加载需要注意的点：</p> <ul><li>要用对应的 loader 加载，比如 gltf 文件用 GLTFLoader。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dirName 目录 fileName 文件名</span>
<span class="token keyword">function</span> <span class="token function">loadGLTFGroup</span><span class="token punctuation">(</span><span class="token parameter">dirName<span class="token punctuation">,</span> fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 封装为 promise 实际业务中用起来更方便</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">loadSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> GLTFGroup <span class="token operator">=</span> model<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>GLTFGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 还支持 progress error 回调函数</span>
    loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> loadSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>gltf 文件渲染需要设置 render.encoding = sRGBEncoding;</li> <li>与美术同事的对接上会有一些协定。结合我们的真实案例，下一小节具体列出一些细节点</li></ul> <h3 id="实际工作中的-tips"><a href="#实际工作中的-tips" class="header-anchor">#</a> 实际工作中的 tips</h3> <p>如果模型是动态数据，并且存在组合情况，比如我的项目中整体呈现的是一座楼，每一层都有一个独立的模型文件，层层之间自由组合形成不同的楼。<br> <img src="/knowledge-system/assets/img/ch3-p2.48c58d67.gif" alt="真实案例gif">
以下称模型文件中楼层主体部分为“楼层主体”，整个模型的空间称为“模型空间”。</p> <ul><li>原点：在模型软件中，不同模型文件的模型空间原点相对于楼层主体都在类似位置。不能 a 模型文件的原点在楼层的房顶左上角，b 模型文件的原点在楼层的地面中间，这样杂乱的原点在组合楼层时需要每个楼层单独位移调整，徒增麻烦。</li> <li>坐标轴：模型软件与 three 坐标轴不一样，需要模型设计师制作模型的时以 three 的坐标轴为准。比如 blender 中 z 轴朝上，而在 three 中 y 轴朝上。并且需要楼层正面保持统一性。不能 a 楼层的正面是朝 z 轴正方向，b 楼层的正面朝 x 轴的负方向。</li> <li>尺寸：不同模型文件楼层主体尺寸应该保持差不多的尺寸。不能 a 的楼层主体是 5m*5m*5m，b 的楼层主体是 500m*500m*500m。这样组合时，楼层堆叠就很不协调，而且可能会超出相机空间或显示太小。</li></ul> <h2 id="动态数据与模型融合-画作处理"><a href="#动态数据与模型融合-画作处理" class="header-anchor">#</a> 动态数据与模型融合：画作处理</h2> <p>有如下比例不一的图片：<br> <img src="/knowledge-system/assets/img/ch4-p0-1.bb3d33de.png" alt="paintings-list">
要放到画框里显示,画框的是模型中的一部分。(例子中画框摆放看起来比较随意，因为无法用真实数据，是模拟的，实际是模型设计师契合模型摆放的)<br> <img src="/knowledge-system/assets/img/ch4-p0.214860b2.gif" alt="frame"><br>
细节功能点包括：</p> <ul><li>画框要适配图片的比例进行变形</li> <li>不超过预设的画框的范围，类似 css 的 object-fit：contain</li></ul> <h3 id="图片数据与模型的融合方案"><a href="#图片数据与模型的融合方案" class="header-anchor">#</a> 图片数据与模型的融合方案</h3> <p>（笔者也是小白入门，如果你有更好的方案欢迎留言！）</p> <h4 id="思路"><a href="#思路" class="header-anchor">#</a> 思路</h4> <p>废话不多说，直接看流程图：<br> <img src="/knowledge-system/assets/img/ch4-p1-1.2606c002.png" alt="阶段三数据交互示意图"><br>
模型中的相框部分单独作为一个 glb 文件，与其他部分（墙壁、房顶、底面、摆件等）剥离开来，方便解析。
解析模型数据，得到相框的位置、旋转量、尺寸。从后端获取图片 url。根据这些信息去创建新的相框物体、图画物体。</p> <p>通过 loader 加载模型后，查看相框模型的数据，如图:<br> <img src="/knowledge-system/assets/img/ch4-p1-2.e4585ee7.png" alt="模型原始数据">
可以看到相框的位置和旋转量容易获取分别是 position、rotation。但是相框的大小不好获取，没有边长参数而是一组顶点数据。</p> <p>那怎么从这些数字中计算出画框的长宽呢，利用正方形的几何特点，取巧地解析了边长数据:<br> <img src="/knowledge-system/assets/img/ch4-p1-3.1a2f73e5.png" alt="模型原始数据">
所以边长其实就是：2*|position[0]| 即：Math.abs(position[0])*2</p> <h4 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 关键方法一 从模型中解析出相框的数据（锚点数据）</span>
<span class="token keyword">function</span> <span class="token function">getAnchors</span><span class="token punctuation">(</span><span class="token parameter">dirName<span class="token punctuation">,</span> fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dirName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">loadSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从模型中取出锚点信息</span>
    <span class="token keyword">let</span> anchors <span class="token operator">=</span> v<span class="token punctuation">.</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取 位置、旋转等信息</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> position<span class="token punctuation">,</span> rotation<span class="token punctuation">,</span> name<span class="token punctuation">,</span> geometry<span class="token punctuation">,</span> material <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
      <span class="token comment">// 计算边长</span>
      <span class="token keyword">const</span> halfOfWidth <span class="token operator">=</span> geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>position<span class="token punctuation">.</span>array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> sideLength <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>halfOfWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 获取相框 框框的颜色</span>
      <span class="token keyword">const</span> borderColor <span class="token operator">=</span> material<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
      <span class="token comment">// 记录锚点信息</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        position<span class="token punctuation">,</span>
        rotation<span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">floor-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>floorIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">~</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        imgIndex<span class="token operator">:</span> index<span class="token punctuation">,</span>
        sideLength<span class="token punctuation">,</span>
        borderColor<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>anchors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> loadSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关键方法二 图片不超过相框范围，类似 object-fit：contain 的效果。</span>
<span class="token comment">/**
 *
 * @param {Number} naturalWidth 图片的宽
 * @param {Number} naturalHeight 图片的高
 * @param {Number} maxSize 相框边长
 * @returns
 */</span>
<span class="token keyword">function</span> <span class="token function">calculateSize</span><span class="token punctuation">(</span><span class="token parameter">naturalWidth<span class="token punctuation">,</span> naturalHeight<span class="token punctuation">,</span> maxSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> k <span class="token operator">=</span> naturalHeight <span class="token operator">/</span> naturalWidth<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//竖版</span>
    <span class="token keyword">const</span> h <span class="token operator">=</span> maxSize<span class="token punctuation">;</span>
    <span class="token keyword">const</span> w <span class="token operator">=</span> h <span class="token operator">/</span> k<span class="token punctuation">;</span>
    size <span class="token operator">=</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//正方形</span>
    size <span class="token operator">=</span> <span class="token punctuation">[</span>maxSize<span class="token punctuation">,</span> maxSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//横版</span>
    <span class="token keyword">const</span> w <span class="token operator">=</span> maxSize<span class="token punctuation">;</span>
    <span class="token keyword">const</span> h <span class="token operator">=</span> w <span class="token operator">*</span> k<span class="token punctuation">;</span>
    size <span class="token operator">=</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关键方法三 获取图片自然宽高</span>
<span class="token keyword">function</span> <span class="token function">getTexture</span><span class="token punctuation">(</span><span class="token parameter">imgUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">loadSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> naturalHeight<span class="token punctuation">,</span> naturalWidth <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>source<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">{</span> texture<span class="token punctuation">,</span> nw<span class="token operator">:</span> naturalWidth<span class="token punctuation">,</span> nh<span class="token operator">:</span> naturalHeight <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">,</span> loadSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>剩下的就是拿到这些信息去创建画作了，比较简单就不放代码了。
<a href="https://codesandbox.io/p/sandbox/pedantic-pascal-06ugc1" target="_blank" rel="noopener noreferrer">demo 完整源码点这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="更多思考"><a href="#更多思考" class="header-anchor">#</a> 更多思考</h3> <h4 id="另一种方案"><a href="#另一种方案" class="header-anchor">#</a> 另一种方案</h4> <p>相框的位置、旋转量、尺寸、图片的 url、尺寸都是来自后端的 json，根据这些信息去创建画作(3d object)，而不需要解析模型数据。<br> <img src="/knowledge-system/assets/img/ch4-p2-1.e7115c4e.png" alt="交互示意图"><br>
这个方案符合常规的开发思路，对前端来说是最友好最方便的。但实际上可行性差，因为模型软件不具备直接导出部分 json 数据的能力，模型导出的数据是二进制文件或者类似这样的 json：<img src="/knowledge-system/assets/img/ch4-p2-2.f378afc8.png" alt="模型软件导出的文件">是很不直观的，不满足我们所需的数据结构。<br>
如果偏要模型导出指定的数据结构，还需要针对模型软件开发一个插件，成本更大不如用上面的 loader 方式解析 glb 二进制数据。</p> <h4 id="另二种方案"><a href="#另二种方案" class="header-anchor">#</a> 另二种方案</h4> <p>不用解析每个相框的定位、边长等信息，直接把相框的几何体按照图片的比例收缩，然后把图片纹理贴到相框上并留些边框的距离。
<img src="/knowledge-system/assets/img/ch4-p2-3.3655c010.png" alt="交互示意图">
这个方案复用了模型中的 3d 相框的位置、旋转量、几何体，看起来不用读取顶点数据了，少了计算，省了事儿。但局部纹理贴图（需要留边距）还是需要计算出边长的具体值，three 里可没有 css 的 calc(100%-边距 px)这样的算法。
就算不考虑边距，复用几何体对模型的依赖比较大，可能出现如下的情况。<br>
期望：
<img src="/knowledge-system/assets/img/ch4-p2-4.116b3b1f.png" alt="正常情况">
可能的错误情况：
<img src="/knowledge-system/assets/img/ch4-p2-5.021fd6a8.png" alt="错误情况"><br>
要避免这种情况，需要模型设计师有一定的纹理映射知识，这对于模型制作者来说会有一定的学习成本，增加了工作流程中的沟通成本。所以这个方案可行性也不高。</p> <h2 id="交互"><a href="#交互" class="header-anchor">#</a> 交互</h2> <p>写不动了，下篇见 ～</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/knowledge-system/web3d/agInteraction/">
        3d入门之交互
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.9a1ee131.js" defer></script><script src="/knowledge-system/assets/js/2.23e8f8fa.js" defer></script><script src="/knowledge-system/assets/js/3.071290b9.js" defer></script>
  </body>
</html>
