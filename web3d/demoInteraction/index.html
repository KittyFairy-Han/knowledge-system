<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="image/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/knowledge-system/assets/css/0.styles.4e160e22.css" as="style"><link rel="preload" href="/knowledge-system/assets/js/app.f8587f51.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/2.23cd175e.js" as="script"><link rel="preload" href="/knowledge-system/assets/js/5.0c0bb1ac.js" as="script"><link rel="prefetch" href="/knowledge-system/assets/js/10.d76e20ac.js"><link rel="prefetch" href="/knowledge-system/assets/js/11.a096bb3d.js"><link rel="prefetch" href="/knowledge-system/assets/js/12.d668933f.js"><link rel="prefetch" href="/knowledge-system/assets/js/13.90b4e877.js"><link rel="prefetch" href="/knowledge-system/assets/js/14.fd693dc0.js"><link rel="prefetch" href="/knowledge-system/assets/js/15.eb12001c.js"><link rel="prefetch" href="/knowledge-system/assets/js/16.b8839a4f.js"><link rel="prefetch" href="/knowledge-system/assets/js/17.5a61ba3b.js"><link rel="prefetch" href="/knowledge-system/assets/js/18.909693f5.js"><link rel="prefetch" href="/knowledge-system/assets/js/19.88d107b1.js"><link rel="prefetch" href="/knowledge-system/assets/js/20.eed8a9b0.js"><link rel="prefetch" href="/knowledge-system/assets/js/21.e1ad5a0f.js"><link rel="prefetch" href="/knowledge-system/assets/js/22.0840bb42.js"><link rel="prefetch" href="/knowledge-system/assets/js/23.83e030d4.js"><link rel="prefetch" href="/knowledge-system/assets/js/24.f22bcb76.js"><link rel="prefetch" href="/knowledge-system/assets/js/25.cc4f52b8.js"><link rel="prefetch" href="/knowledge-system/assets/js/26.380ef35d.js"><link rel="prefetch" href="/knowledge-system/assets/js/27.3685b59a.js"><link rel="prefetch" href="/knowledge-system/assets/js/28.47001d9a.js"><link rel="prefetch" href="/knowledge-system/assets/js/29.4d8114ad.js"><link rel="prefetch" href="/knowledge-system/assets/js/3.6becfab3.js"><link rel="prefetch" href="/knowledge-system/assets/js/30.4e8cf11a.js"><link rel="prefetch" href="/knowledge-system/assets/js/31.7d98b9ae.js"><link rel="prefetch" href="/knowledge-system/assets/js/32.53037506.js"><link rel="prefetch" href="/knowledge-system/assets/js/33.4e01f4c7.js"><link rel="prefetch" href="/knowledge-system/assets/js/34.4f17c91e.js"><link rel="prefetch" href="/knowledge-system/assets/js/35.73c7efae.js"><link rel="prefetch" href="/knowledge-system/assets/js/36.407635c5.js"><link rel="prefetch" href="/knowledge-system/assets/js/37.3a7b747c.js"><link rel="prefetch" href="/knowledge-system/assets/js/38.8b916dbc.js"><link rel="prefetch" href="/knowledge-system/assets/js/39.68870299.js"><link rel="prefetch" href="/knowledge-system/assets/js/4.72ff6d2a.js"><link rel="prefetch" href="/knowledge-system/assets/js/40.90f3b3cb.js"><link rel="prefetch" href="/knowledge-system/assets/js/41.8ffbb1ed.js"><link rel="prefetch" href="/knowledge-system/assets/js/42.fc848e4c.js"><link rel="prefetch" href="/knowledge-system/assets/js/43.c4f109de.js"><link rel="prefetch" href="/knowledge-system/assets/js/44.c425b5e6.js"><link rel="prefetch" href="/knowledge-system/assets/js/45.26031ee5.js"><link rel="prefetch" href="/knowledge-system/assets/js/46.c1623b4b.js"><link rel="prefetch" href="/knowledge-system/assets/js/47.25291ffe.js"><link rel="prefetch" href="/knowledge-system/assets/js/48.2b55719a.js"><link rel="prefetch" href="/knowledge-system/assets/js/49.61248b8f.js"><link rel="prefetch" href="/knowledge-system/assets/js/50.a893be3f.js"><link rel="prefetch" href="/knowledge-system/assets/js/51.e07668b5.js"><link rel="prefetch" href="/knowledge-system/assets/js/52.a4eb1509.js"><link rel="prefetch" href="/knowledge-system/assets/js/53.9b76e387.js"><link rel="prefetch" href="/knowledge-system/assets/js/54.441cdd2f.js"><link rel="prefetch" href="/knowledge-system/assets/js/55.c89e67d7.js"><link rel="prefetch" href="/knowledge-system/assets/js/56.9cb12ff9.js"><link rel="prefetch" href="/knowledge-system/assets/js/57.02b8d3d6.js"><link rel="prefetch" href="/knowledge-system/assets/js/58.e544a614.js"><link rel="prefetch" href="/knowledge-system/assets/js/59.78d1d034.js"><link rel="prefetch" href="/knowledge-system/assets/js/6.7d3f1f43.js"><link rel="prefetch" href="/knowledge-system/assets/js/60.c4614c50.js"><link rel="prefetch" href="/knowledge-system/assets/js/61.d1e64140.js"><link rel="prefetch" href="/knowledge-system/assets/js/62.18e4c1f5.js"><link rel="prefetch" href="/knowledge-system/assets/js/63.82705497.js"><link rel="prefetch" href="/knowledge-system/assets/js/64.34b171dd.js"><link rel="prefetch" href="/knowledge-system/assets/js/65.dff78782.js"><link rel="prefetch" href="/knowledge-system/assets/js/66.5c891979.js"><link rel="prefetch" href="/knowledge-system/assets/js/67.e4aa5c53.js"><link rel="prefetch" href="/knowledge-system/assets/js/68.cd3fb0b9.js"><link rel="prefetch" href="/knowledge-system/assets/js/69.ec47d380.js"><link rel="prefetch" href="/knowledge-system/assets/js/7.1145c0d0.js"><link rel="prefetch" href="/knowledge-system/assets/js/70.654546af.js"><link rel="prefetch" href="/knowledge-system/assets/js/71.c0debf66.js"><link rel="prefetch" href="/knowledge-system/assets/js/72.2753f188.js"><link rel="prefetch" href="/knowledge-system/assets/js/73.c1491318.js"><link rel="prefetch" href="/knowledge-system/assets/js/74.83a64528.js"><link rel="prefetch" href="/knowledge-system/assets/js/75.5575745c.js"><link rel="prefetch" href="/knowledge-system/assets/js/76.39045d26.js"><link rel="prefetch" href="/knowledge-system/assets/js/77.4c537dbc.js"><link rel="prefetch" href="/knowledge-system/assets/js/78.aa2cb08d.js"><link rel="prefetch" href="/knowledge-system/assets/js/79.d940d639.js"><link rel="prefetch" href="/knowledge-system/assets/js/8.f63ac9af.js"><link rel="prefetch" href="/knowledge-system/assets/js/80.06f59ccb.js"><link rel="prefetch" href="/knowledge-system/assets/js/81.5ba294a6.js"><link rel="prefetch" href="/knowledge-system/assets/js/82.9b931bed.js"><link rel="prefetch" href="/knowledge-system/assets/js/83.3e268f75.js"><link rel="prefetch" href="/knowledge-system/assets/js/84.7464fc71.js"><link rel="prefetch" href="/knowledge-system/assets/js/85.07144334.js"><link rel="prefetch" href="/knowledge-system/assets/js/9.f231b4e5.js">
    <link rel="stylesheet" href="/knowledge-system/assets/css/0.styles.4e160e22.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge-system/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link router-link-active">
  web3d
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/knowledge-system/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/knowledge-system/CSS/layout/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/knowledge-system/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/knowledge-system/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/knowledge-system/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/knowledge-system/broswer/work/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/knowledge-system/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><a href="/knowledge-system/scene/lottieUsage/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/knowledge-system/web3d/" class="nav-link router-link-active">
  web3d
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/knowledge-system/web3d/demoStart/" class="sidebar-link">3d入门之空间与模型</a></li><li><a href="/knowledge-system/web3d/demoInteraction/" aria-current="page" class="active sidebar-link">3d入门之交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#交互-相机运动" class="sidebar-link">交互：相机运动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#orbitcontroller" class="sidebar-link">orbitController</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#核心逻辑" class="sidebar-link">核心逻辑</a></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#阻尼效果" class="sidebar-link">阻尼效果</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#交互-物体捕捉" class="sidebar-link">交互：物体捕捉</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#射线检测" class="sidebar-link">射线检测</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge-system/web3d/demoInteraction/#扩展" class="sidebar-link">扩展</a></li></ul></li><li><a href="/knowledge-system/web3d/PORender/" class="sidebar-link">web3d性能优化-渲染</a></li><li><a href="/knowledge-system/web3d/POLoad/" class="sidebar-link">web3d性能优化-加载</a></li><li><a href="/knowledge-system/web3d/ARStart/" class="sidebar-link">入门AR</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>这篇是接着上一篇的，如果没有开发基础，建议先把上一篇前面两小节看过再来看～</p> <h4 id="说在前面"><a href="#说在前面" class="header-anchor">#</a> 说在前面</h4> <p>真实案例线上预览:<img src="/knowledge-system/assets/img/ch0-1.d332391f.png" alt="网易星球数字藏品馆">
demo 预览:<img src="/knowledge-system/assets/img/ch0-2.43f1e8c6.png" alt="网易星球数字藏品馆"><br> <a href="https://codesandbox.io/p/sandbox/pedantic-pascal-06ugc1" target="_blank" rel="noopener noreferrer">demo 完整代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="交互-相机运动"><a href="#交互-相机运动" class="header-anchor">#</a> 交互：相机运动</h2> <p>首先要有一个基础认知那就是在 3D 空间浏览场景通常是相机运动而不是模型运动，所以主体思路就是识别移动端的手势（在 pc 端就是鼠标操作），根据手势和滑动距离来计算相机的运动方式与运动距离。<br>
很多 3d 项目基本都是用相机轨道运动 orbitController 所以先介绍一下 orbitController。</p> <h3 id="orbitcontroller"><a href="#orbitcontroller" class="header-anchor">#</a> orbitController</h3> <p><a href="https://threejs.org/examples/?q=orb#misc_controls_orbit" target="_blank" rel="noopener noreferrer">官方例子感受一下～<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 运动解析：</p> <h4 id="首先想象相机在一个球面的某个位置"><a href="#首先想象相机在一个球面的某个位置" class="header-anchor">#</a> 首先想象相机在一个<strong>球面</strong>的某个位置：</h4> <ul><li>左键水平拖动，相机的运动轨迹是类似经线一样的曲线运动。</li> <li>左键竖直拖动，相机的运动轨迹是类似纬线一样的曲线运动。</li> <li>鼠标滚轮滚动，相机的运动轨迹朝着球心远近平移。
<blockquote><p>注意 是圆角坐标系的曲线运动，而不是相机自转<br> <img src="data:image/png;base64,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" alt="曲线运动"></p></blockquote></li></ul> <h4 id="然后再想象相机在一个垂直于屏幕的平面上"><a href="#然后再想象相机在一个垂直于屏幕的平面上" class="header-anchor">#</a> 然后再想象相机在一个垂直于屏幕的<strong>平面</strong>上，</h4> <ul><li>右键水平拖动，相机的运动轨迹是横向平移。</li> <li>右键竖直拖动，相机的运动轨迹是远近平移。
<blockquote><p>可以通过配置，修改平面是平行于屏幕的，这样，右键竖直拖动，相机的运动轨迹是垂直平移。</p></blockquote></li></ul> <h3 id="核心逻辑"><a href="#核心逻辑" class="header-anchor">#</a> 核心逻辑</h3> <p>实际项目中的交互可能无法复用 OrbitControl 等 three 封装好的组件（比如我们的就是），不过定义一套交互系统无外乎两个关键点。</p> <ul><li>移动端监听 touch 事件、pc 端监听鼠标键盘事件</li> <li>控制相机运动</li></ul> <p>下面就用</p> <ul><li>单指水平滑动：相机原地自转</li> <li>单指垂直滑动：相机沿着平行于 y 轴的方向平移</li> <li>斜着滑：以上两种运动结合</li></ul> <p>举例子。 结合 demo 效果和<a href="https://codesandbox.io/p/sandbox/pedantic-pascal-06ugc1" target="_blank" rel="noopener noreferrer">结合 demo 效果和完整代码看更好理解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，别忘记调为手机模式哦～</p> <h4 id="流程"><a href="#流程" class="header-anchor">#</a> 流程</h4> <p><img src="/knowledge-system/assets/img/ch1-p2.afaf90ca.png" alt="流程图"></p> <h4 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Vector2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 自定义控制器
 * 单指滑动，水平分量负责绕y轴旋转，垂直分量负责y轴方向平移
 * object 就是相机
 * domElement 就是 canvas
 */</span>
<span class="token keyword">class</span> <span class="token class-name">CustomControls</span> <span class="token punctuation">{</span>
  <span class="token comment">// static single = null;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> domElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ==================== 实例属性 ==================== */</span>

    <span class="token comment">// 控制的对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token comment">// canvas</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>domElement <span class="token operator">=</span> domElement<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>touchAction <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span> <span class="token comment">// disable touch scroll</span>
    <span class="token comment">// 旋转速度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rotateSpeed <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 位移速度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>panSpeed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// 控制的对象最高位置</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>panRangeMax <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">// 控制的对象最低位置</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>panRangeMin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 是否启用</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">/* ==================== 内部变量和方法 ==================== */</span>

    <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> deltaPan <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//实时平移量</span>
    <span class="token keyword">let</span> deltaRotate <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//实时旋转量</span>
    <span class="token keyword">let</span> pointStart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//上一次的touch位置</span>

    <span class="token comment">// 控制平移的范围</span>
    <span class="token keyword">function</span> <span class="token function">getSafePosY</span><span class="token punctuation">(</span><span class="token parameter">oldY<span class="token punctuation">,</span> panOffset</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldY <span class="token operator">+</span> panOffset <span class="token operator">&gt;</span> scope<span class="token punctuation">.</span>panRangeMax<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">.</span>panRangeMax<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldY <span class="token operator">+</span> panOffset <span class="token operator">&lt;</span> scope<span class="token punctuation">.</span>panRangeMin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">.</span>panRangeMin<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> oldY <span class="token operator">+</span> panOffset<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 控制旋转角度在0~2PI</span>
    <span class="token keyword">function</span> <span class="token function">getSafeRoY</span><span class="token punctuation">(</span><span class="token parameter">old<span class="token punctuation">,</span> delta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>old <span class="token operator">+</span> delta<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 不使用阻尼的运动</span>
    <span class="token keyword">function</span> <span class="token function">acting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">getSafePosY</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> deltaPan<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">getSafeRoY</span><span class="token punctuation">(</span>
        scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        deltaRotate
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">onTouchStart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 禁用、非单指则不继续监听move和end事件</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>scope<span class="token punctuation">.</span>enabled <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> touchNumber <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>touchNumber <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 取出初始触控点，记录到pointStart中，作为初始向量</span>
      <span class="token keyword">const</span> touch <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> touch<span class="token punctuation">;</span>
      pointStart<span class="token punctuation">.</span>x <span class="token operator">=</span> pageX<span class="token punctuation">;</span>
      pointStart<span class="token punctuation">.</span>y <span class="token operator">=</span> pageY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">onTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 禁用、非单指则不触发相机运动的逻辑</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>scope<span class="token punctuation">.</span>enabled <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> touchNumber <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>touchNumber <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 计算触控滑动向量</span>
      <span class="token keyword">const</span> touch <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> touch<span class="token punctuation">;</span>
      <span class="token keyword">const</span> pointerMove <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>pageX<span class="token punctuation">,</span> pageY<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> deltaMove <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span>pointerMove<span class="token punctuation">,</span> pointStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 以“竖向滑动为一屏距离则可以移动一米”为平移单位速度</span>
      <span class="token keyword">const</span> perPan <span class="token operator">=</span> <span class="token punctuation">(</span>deltaMove<span class="token punctuation">.</span>y <span class="token operator">/</span> scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token comment">// 此次平移的距离</span>
      deltaPan <span class="token operator">+=</span> scope<span class="token punctuation">.</span>panSpeed <span class="token operator">*</span> perPan<span class="token punctuation">;</span>
      <span class="token comment">// 以“横向滑动为一屏距离则可以转一圈”为单位旋转速度</span>
      <span class="token keyword">const</span> perRo <span class="token operator">=</span> <span class="token punctuation">(</span>deltaMove<span class="token punctuation">.</span>x <span class="token operator">/</span> scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">;</span>
      <span class="token comment">// 此次旋转的弧度</span>
      deltaRotate <span class="token operator">+=</span> scope<span class="token punctuation">.</span>rotateSpeed <span class="token operator">*</span> perRo<span class="token punctuation">;</span>
      <span class="token comment">// 运动（无阻尼）</span>
      <span class="token function">acting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 更新 pointStar 的值，为下次进入 move 事件做准备</span>
      pointStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>pointerMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* ==================== 构造函数逻辑 ==================== */</span>
    <span class="token comment">// 监听 touch 事件</span>
    scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span> onTouchStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> onTouchMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="效果"><a href="#效果" class="header-anchor">#</a> 效果</h4> <p><img src="/knowledge-system/assets/img/ch1-p2.5cc5da28.gif" alt="效果"><br>
有两个问题：</p> <ul><li>有时转速很快，出现了乱转的情况。这是因为我们相机的运动逻辑没有写到帧渲染函数中。</li> <li>对比 OrbitControls 少了惯性效果，看起来很生硬。</li></ul> <p>下面就来解决这两个问题</p> <h3 id="阻尼效果"><a href="#阻尼效果" class="header-anchor">#</a> 阻尼效果</h3> <h4 id="流程-2"><a href="#流程-2" class="header-anchor">#</a> 流程</h4> <p><img src="/knowledge-system/assets/img/ch1-p3.937c37c5.png" alt="流程图"></p> <h4 id="代码-2"><a href="#代码-2" class="header-anchor">#</a> 代码</h4> <p><img src="/knowledge-system/assets/img/ch1-p3.97a909d9.jpeg" alt="代码变更"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Vector2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 自定义控制器
 * 单指滑动，水平分量负责绕y轴旋转，垂直分量负责y轴方向平移
 * object 就是相机
 * domElement 就是 canvas
 */</span>
<span class="token keyword">class</span> <span class="token class-name">CustomControls</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//（新增）</span>
    <span class="token comment">//controls与App3dScene模块独立，主渲染函数在App3dScene中</span>
    <span class="token comment">//模仿TWEEN，update挂在静态函数上，方便插入主渲染函数</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// static single = null;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> domElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ==================== 实例属性 ==================== */</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token comment">// .... 不变</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 阻尼系数 越小惯性越大 1的时候没有惯性效果（新增）</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dampingFactor <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>

    <span class="token comment">/* ==================== 内部变量和方法 ==================== */</span>

    <span class="token comment">// ... 删掉 acting 方法其他不变</span>

    <span class="token keyword">function</span> <span class="token function">onTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>scope<span class="token punctuation">.</span>enabled <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token comment">// ... 删掉 acting() 调用，其他不变</span>
      pointStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>pointerMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* ==================== 构造函数逻辑 ==================== */</span>
    <span class="token comment">// 监听 touch 事件</span>
    scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchstart&quot;</span><span class="token punctuation">,</span> onTouchStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scope<span class="token punctuation">.</span>domElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;touchmove&quot;</span><span class="token punctuation">,</span> onTouchMove<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 相机运动（有阻尼），主渲染函数调用update （新增）</span>
    CustomControls<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//当前帧相机运动</span>
      <span class="token keyword">const</span> stepPan <span class="token operator">=</span> scope<span class="token punctuation">.</span>dampingFactor <span class="token operator">*</span> deltaPan<span class="token punctuation">;</span>
      <span class="token keyword">const</span> stepRo <span class="token operator">=</span> scope<span class="token punctuation">.</span>dampingFactor <span class="token operator">*</span> deltaRotate<span class="token punctuation">;</span>
      scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">getSafePosY</span><span class="token punctuation">(</span>scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> stepPan<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ！！！不要用 rotateY()，当其他地方也有旋转操作会有 bug，具体原因涉及较多 欧拉角四元数转换计算，不展开说明</span>
      scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">getSafeRoY</span><span class="token punctuation">(</span>scope<span class="token punctuation">.</span>object<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y<span class="token punctuation">,</span> stepRo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//下一帧预备</span>
      deltaPan <span class="token operator">*=</span> <span class="token number">1</span> <span class="token operator">-</span> scope<span class="token punctuation">.</span>dampingFactor<span class="token punctuation">;</span>
      deltaRotate <span class="token operator">*=</span> <span class="token number">1</span> <span class="token operator">-</span> scope<span class="token punctuation">.</span>dampingFactor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="效果-2"><a href="#效果-2" class="header-anchor">#</a> 效果</h4> <p><img src="/knowledge-system/assets/img/ch1-p3.464347de.gif" alt="效果"></p> <h2 id="交互-物体捕捉"><a href="#交互-物体捕捉" class="header-anchor">#</a> 交互：物体捕捉</h2> <h3 id="射线检测"><a href="#射线检测" class="header-anchor">#</a> 射线检测</h3> <p>3d 空间的物体不像 dom 可以绑定各种事件监听，而是用射线检测对物体进行拾取。<br>
关键代码就两行：</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> raycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//射线</span>
raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span>pointer<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//由相机发出射线</span>
<span class="token keyword">const</span> intersects <span class="token operator">=</span> raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>targetObjects<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检测</span>
</code></pre></div><p>结合我们的 demo，传入对应的参数，就可以捕获场景中的作品了。详见 demo</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">PickHelper</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @targetDom 一般是canvas元素
   * @camera {THREE.Object3D} 3d场景中的相机
   * @targetObjects {Array} 3d场景中需要捕获的群体
   * @handlePick {Function} 拾取后回调
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> targetDom<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> targetObjects<span class="token punctuation">,</span> <span class="token function-variable function">handlePick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实例属性和方法 ================================</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 是否启用拾取</span>

    <span class="token comment">// 内部变量 =====================================</span>
    <span class="token keyword">const</span> raycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//射线</span>
    <span class="token keyword">const</span> pointer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用来存click点的数据</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleTrigger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log(e)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 记录了归一化的鼠标位置,无论画布的尺寸，</span>
      pointer<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">/</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>clientWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 我们需要一个从左到右，落入区间（-1，1）的值，</span>
      pointer<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY <span class="token operator">/</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 类似的，也需要一个从下到上，落入区间（-1，1）的值。</span>
      <span class="token comment">// ==========================</span>
      <span class="token comment">// 如果用了hammer,e是hammer包装过一层的，标准的取值应该是e.srcEvent.pageY,而不是用e.center.y</span>
      <span class="token comment">// 因为如果 e.target 有滚动（有scrollY）那么只能用pageY；水平方向同理</span>
      <span class="token comment">// 需要注意的是100vh有时候会超过window.innerHeight，这样就有了scrollY，比如Safari浏览器</span>
      <span class="token comment">// ==========================</span>
      raycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span>pointer<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//由相机发出射线</span>
      <span class="token keyword">const</span> intersects <span class="token operator">=</span> raycaster<span class="token punctuation">.</span><span class="token function">intersectObjects</span><span class="token punctuation">(</span>targetObjects<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检测</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>intersects<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>firstPickOne<span class="token punctuation">]</span> <span class="token operator">=</span> intersects<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结果传给回调函数</span>
      <span class="token function">handlePick</span><span class="token punctuation">(</span>firstPickOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 构造函数逻辑，注册点击事件</span>
    targetDom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handleTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 实例方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">destroy</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      targetDom<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handleTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>大概效果就是<br> <img src="/knowledge-system/assets/img/ch2.96f9f244.gif" alt=""></p> <h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <ul><li>实际的移动端 web 应用交互会更复杂一些，如果涉及手势识别比较多的建议用 hammer.js</li> <li>点击后需要相机做过度运镜可以结合 Tween.js</li> <li>使用 hammer.js 注册事件，捕获物体时，需要用原生的 e.target.pageX,e.targe.pageY。否则有些浏览器会捕获不准。详见代码注释</li> <li>捕获对象发生改变时候（比如更新图片了），需要更新 picker 中的 targeObjects</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/knowledge-system/web3d/demoStart/" class="prev">
        3d入门之空间与模型
      </a></span> <span class="next"><a href="/knowledge-system/web3d/PORender/">
        web3d性能优化-渲染
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/knowledge-system/assets/js/app.f8587f51.js" defer></script><script src="/knowledge-system/assets/js/2.23cd175e.js" defer></script><script src="/knowledge-system/assets/js/5.0c0bb1ac.js" defer></script>
  </body>
</html>
